<?xml version="1.0" encoding="UTF-8"?>
<modification>
  <id>Product Option Image PRO / Изображения опций PRO</id>
  <version>2.2.0</version>
  <vqmver>2.5.X</vqmver>
  <author>Support: support@liveopencart.com / Поддержка: help@liveopencart.ru</author>
  
  
  <file name="admin/model/catalog/option.php,admin/model/catalog/mvd_option.php,admin/model/catalog/vdi_option.php" error="skip">
  
    <operation>
      <search position="after"><![CDATA[
      $this->db->query("DELETE FROM " . DB_PREFIX . "option_description
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->model_module_product_option_image_pro->deleteRealOptionSettings($option_id);
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation>
      <search position="before"><![CDATA[
      if (isset($data['option_value'])) {
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      if (isset($data['poip_settings'])) {
        $this->model_module_product_option_image_pro->setRealOptionSettings($option_id, $data['poip_settings']);
      }
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
  </file>
  
  <file name="admin/controller/catalog/option.php,admin/controller/catalog/mvd_option.php,admin/controller/catalog/vdi_option.php" error="skip">
    
    <!-- LANGUAGE OC 2.0.X -->
		<operation error="skip">
      <search position="before"><![CDATA[
      $this->load->language('catalog/
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      $this->load->language('module/product_option_image_pro');
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- LANGUAGE OC 2.1.X -->
		<operation error="skip">
      <search position="before"><![CDATA[
      $this->language->load('catalog/
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      $this->language->load('module/product_option_image_pro');
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- MODULE INSTALLED FLAG & MODULE ENTRIES-->
    <operation >
      <search position="after"><![CDATA[
      function getForm()
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $data['poip_settings_names'] = $this->model_module_product_option_image_pro->getSettingsNames();
      $data['poip_settings_values'] = $this->model_module_product_option_image_pro->getSettingsValues();
      $data['poip_module_name'] = $this->language->get('poip_module_name');
      $data['poip_saved_settings'] = $this->model_module_product_option_image_pro->getRealOptionSettings( isset($this->request->get['option_id']) ? $this->request->get['option_id'] : 0 );
      
      $data['entry_sort_order_short'] = $this->language->get('entry_sort_order_short');
      $data['poip_settings_select_options'] = array('0'=>$this->language->get('entry_settings_default'), '2'=>$this->language->get('entry_settings_yes'), '1'=>$this->language->get('entry_settings_no'));
      
      $settings_names = $this->model_module_product_option_image_pro->getSettingsNames(false);
      foreach ($settings_names as $setting_name) {
        $data['entry_'.$setting_name] = $this->language->get('entry_'.$setting_name);
        $data['entry_'.$setting_name.'_help'] = $this->language->get('entry_'.$setting_name.'_help');
      }
      $settings_values = $this->model_module_product_option_image_pro->getSettingsValues();
      foreach ($settings_values as $setting_value) {
        $data[$setting_value] = $this->language->get($setting_value); // new
      }
      $data['settings_values'] = $settings_values;
      
			$data['entry_show_hide'] = $this->language->get('entry_show_hide');
      //$data['entry_show_settings'] = $this->language->get('entry_show_settings');
      //$data['entry_hide_settings'] = $this->language->get('entry_hide_settings');
      
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>
  
  
  <file name="admin/view/template/catalog/option_form.tpl,admin/view/template/catalog/mvd_option_form.tpl,admin/view/template/catalog/vdi_option_form.tpl" error="skip">
    
    <operation >
      <search position="before"><![CDATA[<table id="option-value" class="table table-striped table-bordered table-hover">]]></search>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php  if ( !empty($poip_installed) ) {  ?>
			
				<div class="form-group">
					<label class="col-sm-2 control-label" for="input-sort-order"><?php echo $poip_module_name; ?>:</label>
					<div class="col-sm-10">
						
						<?php foreach ($poip_settings_names as $poip_setting_name) { ?>
							<div class="col-sm-4">
							<?php echo ${"entry_".$poip_setting_name}; ?>:
							<select name="poip_settings[<?php echo $poip_setting_name; ?>]" class="form-control">
								<?php
									$poip_html = "";
									
									// new
									if (in_array('entry_'.$poip_setting_name."_v0", $poip_settings_values)) {
										$poip_html .= "<option value=\"0\" ".(isset($poip_saved_settings[$poip_setting_name]) && $poip_saved_settings[$poip_setting_name]==0 ? "selected":"").">".$poip_settings_select_options[0]."</option>";
										for ($i=1; $i<9; $i++) {
											if (in_array('entry_'.$poip_setting_name."_v".$i, $poip_settings_values)) {
												$poip_html .= "<option value=\"".(1+$i)."\" ".(isset($poip_saved_settings[$poip_setting_name]) && $poip_saved_settings[$poip_setting_name]==(1+$i) ? "selected":"").">".${("entry_".$poip_setting_name."_v".$i)}."</option>";
											}
										}
										$poip_html .= "<option value=\"".(1)."\" ".(isset($poip_saved_settings[$poip_setting_name]) && $poip_saved_settings[$poip_setting_name]==1 ? "selected":"").">".${("entry_".$poip_setting_name."_v0")}."</option>";
									} else {
										foreach ($poip_settings_select_options as $select_value => $select_name) {
											$poip_html .= "<option value=\"".$select_value."\" ".(isset($poip_saved_settings[$poip_setting_name]) && $poip_saved_settings[$poip_setting_name]==$select_value ? "selected":"").">".$select_name."</option>";
										}
									}
									echo $poip_html;
								?>
								
							</select>
							</div>
						<?php } ?>
						
					</div>
				</div>
      
      <?php  }  ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
    
  </file>
  
  <file name="admin/model/catalog/product.php,admin/model/catalog/mvd_product.php,admin/model/catalog/vdi_product.php,admin/model/catalog/product_aepro.php" error="skip">
    
    <!-- ADD & EDIT PRODUCT - DELETE OPTIONS IMAGES & OPTIONS IMAGE SETINGS-->
    <operation >
      <search position="after"><![CDATA[
      $this->db->query("DELETE FROM " . DB_PREFIX . "product_option WHERE product_id
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->model_module_product_option_image_pro->deleteProductOptionValueImages($product_id);
      $this->model_module_product_option_image_pro->deleteRealProductSettings($product_id);
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- ADD & EDIT PRODUCT - SAVE OPTIONS IMAGES -->
    <operation >
      <search position="after"><![CDATA[
      $this->db->query("INSERT INTO " . DB_PREFIX . "product_option_value
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      $product_option_value_id = $this->db->getLastId();
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      if (isset($product_option_value['images'])) {
        $this->model_module_product_option_image_pro->saveProductOptionValueImages($product_id, $product_option_id, $product_option_value_id, $product_option_value['images']);
      }
			
			// dependent options and others compatibility (product_option_image_pro.xml - must be loaded after them)
			// delete and new insert - give as correct result of $product_option_value_id = $this->db->getLastId();
			$query_pov = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_option_value WHERE product_option_value_id = ".$product_option_value_id." ");
			if ($query_pov->num_rows) {
				
				$sql_set = "";
				foreach ($query_pov->row as $pov_key => $pov_value) {
					$sql_set .= ", `".$pov_key."` = '".$pov_value."' ";
				}
				$sql_set = substr($sql_set, 1);
				$this->db->query("DELETE FROM " . DB_PREFIX . "product_option_value WHERE product_option_value_id = ".$product_option_value_id." ");
				$this->db->query("INSERT INTO " . DB_PREFIX . "product_option_value SET ".$sql_set);
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- ADD & EDIT PRODUCT - SAVE PRODUCT OPTIONS IMAGE SETTINGS -->
    <operation >
      <search position="after"><![CDATA[
			$product_option_id = $this->db->getLastId();
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      if (isset($product_option['poip_settings'])) {
        $this->model_module_product_option_image_pro->setRealProductSettings($product_id, $product_option_id, $product_option['poip_settings']);
      }
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- GET PRODUCT OPTIONS WITH IMAGES & MODULE SETTINGS-->
    <operation >
      <search position="after"><![CDATA[
      public function getProductOptions($product_id)
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $images = $this->model_module_product_option_image_pro->getProductOptionImages($product_id);
      $product_poip_settings = $this->model_module_product_option_image_pro->getRealProductSettings($product_id);
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation >
      <search position="before"><![CDATA[
      $product_option_value_data[] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      $option_value_images = array();
      if (isset($images[$product_option['product_option_id']][$product_option_value['product_option_value_id']])) {
        foreach ($images[$product_option['product_option_id']][$product_option_value['product_option_value_id']] as $poip_image) {
          $option_value_images[] = $poip_image;
        }
      }
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation >
      <search position="after"><![CDATA[
      $product_option_value_data[] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      'images' => $option_value_images,
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation >
      <search position="after"><![CDATA[
      $product_option_data[] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      'poip_settings' => (isset($product_poip_settings[$product_option['product_option_id']]) ? $product_poip_settings[$product_option['product_option_id']] : false),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
		<!-- // new  -->
		<operation >
      <search position="after"><![CDATA[
      $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_image WHERE product_id = '" . (int)$product_id
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
			if ($this->model_module_product_option_image_pro->installed()) {
			
				$poip_global_settings = $this->model_module_product_option_image_pro->getGlobalSettings();
				if ( $poip_global_settings['options_images_edit'] == 1 ) {
					
					$poip_options_for_images = $this->model_module_product_option_image_pro->getOptionsForImages($product_id);
					
					$included_images = array();
					foreach ($query->rows as &$row) {
						if ( isset($poip_options_for_images[$row['image']]) ) {
							$row['poip'] = $poip_options_for_images[$row['image']];
							$included_images[] = $row['image'];
						} else {
							$row['poip'] = false;
						}
					}
					unset($row);
					
					// if option images is not set for additional image - add this image in additional images array
					foreach ($poip_options_for_images as $poip_image => $image_options) {
						if ( !in_array($poip_image, $included_images) ) {
							$query->rows[] = array('product_image_id'=>0, 'product_id'=>$product_id, 'image'=>$poip_image, 'sort_order'=>0, 'poip'=>$image_options);
						}
					}
					
				}
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
  
		
		<!-- // new  -->
		<operation >
      <search position="before" offset="2"><![CDATA[
      $this->db->query("INSERT INTO `" . DB_PREFIX . "product_recurring
      ]]></search>
      <!--
      <search position="before"><![CDATA[
      $this->event->trigger('post.admin.product.add', $product_id);
      ]]></search>
      -->
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if (isset($data['product_image'])) {
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$this->model_module_product_option_image_pro->saveOptionsForImages($product_id, $data['product_image']);
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
  </file>
  
  
  <file name="admin/controller/catalog/product.php,admin/controller/catalog/mvd_product.php,admin/controller/catalog/vdi_product.php,admin/controller/catalog/product_aepro.php" error="skip">
    
		<!-- LANGUAGE product_aepro 
		<operation error="skip">
      <search position="before"><![CDATA[
      $this->load->language('catalog/product_aepro');
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      $this->load->language('module/product_option_image_pro');
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		-->
		
    <!-- LANGUAGE OC 2.0.X -->
		<operation error="skip">
      <search position="before"><![CDATA[
      $this->load->language('catalog/
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      $this->load->language('module/product_option_image_pro');
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- LANGUAGE OC 2.1.X -->
		<operation error="skip">
      <search position="before"><![CDATA[
      $this->language->load('catalog/
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      $this->language->load('module/product_option_image_pro');
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    
    <!-- MODULE INSTALLED FLAG & MODULE ENTRYES-->
    <operation >
      <search position="after"><![CDATA[
      function getForm()
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
			$data['poip_global_settings'] = $this->model_module_product_option_image_pro->getGlobalSettings();
      $data['poip_settings_names'] = $this->model_module_product_option_image_pro->getSettingsNames();
      $data['poip_settings_values'] = $this->model_module_product_option_image_pro->getSettingsValues();
      $data['poip_module_name'] = $this->language->get('poip_module_name');
      $data['poip_saved_settings'] = $this->model_module_product_option_image_pro->getRealProductSettings( isset($this->request->get['product_id']) ? $this->request->get['product_id'] : 0 );
			
			$data['entry_sort_order_short'] = $this->language->get('entry_sort_order_short');
      $data['poip_settings_select_options'] = array('0'=>$this->language->get('entry_settings_default'), '2'=>$this->language->get('entry_settings_yes'), '1'=>$this->language->get('entry_settings_no'));
      
      $settings_names = $this->model_module_product_option_image_pro->getSettingsNames(false);
      foreach ($settings_names as $setting_name) {
        $data['entry_'.$setting_name] = $this->language->get('entry_'.$setting_name);
        $data['entry_'.$setting_name.'_help'] = $this->language->get('entry_'.$setting_name.'_help');
      }
      $settings_values = $this->model_module_product_option_image_pro->getSettingsValues();
      foreach ($settings_values as $setting_value) {
        $data[$setting_value] = $this->language->get($setting_value); // new
      }
      $data['settings_values'] = $settings_values;
      
      $data['entry_show_settings'] = $this->language->get('entry_show_settings');
      $data['entry_hide_settings'] = $this->language->get('entry_hide_settings');
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- OPTIONS IMAGES TO TPL -->
    <operation >
      <search position="after"><![CDATA[
      $product_option_value_data[] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      'images' => (isset($product_option_value['images'])? $this->model_module_product_option_image_pro->addThumbsIfNeeded($product_option_value['images']) : array()),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
		<!-- // new -->
		<operation error="log">
      <search position="after"><![CDATA[
      $data['product_images'][] = array(
      ]]></search>
      <add><![CDATA[
      // << Product Option Image PRO module
      'poip'      => isset($product_image['poip']) ? $product_image['poip'] : false,
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>
  
  
  
  <file name="admin/view/template/catalog/product_form.tpl,admin/view/template/catalog/mvd_product_form.tpl,admin/view/template/catalog/vdi_product_form.tpl,admin/view/template/catalog/product_form_aepro.tpl,admin/view/template/catalog/product_form_aepro_modal.tpl,admin/view/template/catalog/product_tshirtecommerce.tpl" error="skip">
    
		<!-- << OPTIONS FOR IMAGES STYLE // new -->
		
		<operation >
      <search position="before"><![CDATA[
      <td class="text-right"><?php echo $entry_sort_order; ?></td>
      ]]></search>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php if ( !empty($poip_installed) && $poip_global_settings['options_images_edit'] == 1 ) { //new ?>
        
					<td class="text-left"><?php echo $entry_option; ?></td>  
					
			<?php } ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		 
		<operation error="skip">
      <search position="before"><![CDATA[
      <td class="text-left"><button type="button" onclick="addImage()
      ]]></search>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php if ( !empty($poip_installed) && $poip_global_settings['options_images_edit'] == 1 ) { //new ?>
        
					<td class="text-left"></td>
					
			<?php } ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		
		<!-- Power Image Manager 2.0 comp -->
		<operation error="skip">
      <search position="before"><![CDATA[
      <td class="text-left"><?php if ($pim_status){?><a type="button" data-toggle="manager
      ]]></search>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php if ( !empty($poip_installed) && $poip_global_settings['options_images_edit'] == 1 ) { //new ?>
        
					<td class="text-left"></td>
					
			<?php } ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		
		<!-- Power Image Manager 2.0 comp -->		
		<operation error="skip">
      <search position="after"><![CDATA[
      html += '<img src="'+json.file+'" alt="" title="" data-placeholder="<?php echo $placeholder; ?>" />';
      ]]></search>
      <add><![CDATA[
      // << Product Option Image PRO module
      <?php if ( !empty($poip_installed) ) { ?>
        
					var current_block = $('[id^="div_option_image"][data-poip-fm-active]');
					if ( current_block.length ) {
						
						if ( !current_block.find('input[type="hidden"][id^="option_image"]').attr('value') ) {
							
							current_block.find('input[type="hidden"][id^="option_image"]').attr('value', decodeURIComponent(json.abs));
							current_block.find('a[data-toggle="image"] img').attr('src', json.file);
						} else {
						
							if ( current_block.parent().siblings('button[onclick^="add_option_image"]').length ) {
								current_block.parent().siblings('button[onclick^="add_option_image"]').click();
								
								var new_block = current_block.siblings('[id^="div_option_image"]:last');
								new_block.find('input[type="hidden"][id^="option_image"]').attr('value', decodeURIComponent(json.abs));
								new_block.find('a[data-toggle="image"] img').attr('src', json.file);
								
							}
						}
						return;
					}
			<?php } ?>
      // >> Product Option Image PRO module
				]]></add>
    </operation>
		
		
		<operation >
      <search position="after" regex="true" index="1"><![CDATA[~<div id="content">|<div class="modal-content">~]]></search>
			<!-- <search position="after"><![CDATA[<div id="content">]]></search> -->
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php if ( !empty($poip_installed) && $poip_global_settings['options_images_edit'] == 1 ) { //new ?>
        
				<script type="text/javascript"><!--
					
					var product_options = <?php echo (isset($product_options) && $product_options) ? json_encode($product_options) : 'false' ; ?>;
					var option_values = <?php echo (isset($option_values) && $option_values) ? json_encode($option_values) : 'false' ; ?>;
					
					function poip_get_product_option_value_name(option_id, option_value_id) {
						for (var i in option_values[option_id]) {
							if (option_values[option_id][i]['option_value_id'] == option_value_id) {
								return option_values[option_id][i]['name'];
							}
						}
					}
					
					function poip_show_image_options(row, data) {
						if ( !$('#image-row'+row).length ) return;
						if ( !$('#image-row'+row+' td[data-poip-options]').length ) {
							$('#image-row'+row+' td:first').after('<td class="text-right" data-poip-options style="vertical-align: top;"></td>');
						}
						
						var html = '';
						
						for (var i in product_options) {
							if ( !product_options.hasOwnProperty(i) ) continue;
							
							var product_option = product_options[i];
							
							if ( $.inArray(product_option['type'], ['select', 'radio', 'image', 'checkbox', 'color', 'block']) != -1) {
								
								html+= '<div class="col-sm-2 text-left">';
								html+= '<b>'+product_option['name']+'</b><br>';
								
								for (var j in product_option['product_option_value']) {
									if ( !product_option['product_option_value'].hasOwnProperty(j) ) continue;
								
									var product_option_value = product_option['product_option_value'][j];
									
									html+= '<div class="checkbox" style="min-height: 20px;padding-top:1px;white-space:nowrap;">';
									html+= '<label>';
									html+= '<input type="checkbox" name="product_image['+row+'][poip]['+product_option['option_id']+'][]" value="'+product_option_value['option_value_id']+'"';
									if (data && data['poip'] && data['poip'][product_option['option_id']]) {
										if ( $.inArray(product_option_value['option_value_id'], data['poip'][product_option['option_id']]) != -1 ) {
											html+= ' checked ';
										}
									}
									html+= '>&nbsp;'+poip_get_product_option_value_name(product_option['option_id'], product_option_value['option_value_id']);
									html+= '</label>';
									html+= '</div>';
									
									html+= '';
									html+= '';
								}
								html+= '</div>';
							}
						}
						$('#image-row'+row+' td[data-poip-options]').html(html);
					}
				//--></script>
					
			<?php } ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		
		<operation >
      <search position="before"><![CDATA[
      <?php $image_row++; ?>
      ]]></search>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php if ( !empty($poip_installed) && $poip_global_settings['options_images_edit'] == 1 ) { //new ?>
        
				<script type="text/javascript"><!--
					poip_show_image_options(<?php echo $image_row; ?>, <?php echo json_encode($product_image); ?>);
				//--></script>
					
			<?php } ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		
		<operation >
      <search position="after"><![CDATA[
      $('#images tbody').append(html);
      ]]></search>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php if ( !empty($poip_installed) && $poip_global_settings['options_images_edit'] == 1 ) { //new ?>
				poip_show_image_options(image_row);
			<?php } ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		
		<!-- >> OPTIONS FOR IMAGES STYLE -->
		
    <!-- MODULE INIT -->
    <operation error="skip">
			<search position="iafter" index="1"><![CDATA[<?php echo $header; ?>]]></search>
			<!--<search position="after" regex="true" index="1"><![CDATA[~<\?php echo \$header; \?>|<div class="modal-dialog">~]]></search>-->
      <!-- <search position="after"><![CDATA[<?php echo $header; ?>]]></search> -->
			<ignoreif><![CDATA[SET POIP SCRIPT AFTER HEADER]]></ignoreif>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php
        if (!empty($poip_installed)) {
					// SET POIP SCRIPT AFTER HEADER
          $poip_script = "";
        }
      ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		
		<operation error="skip">
			<search position="iafter" index="1"><![CDATA[<div class="modal-dialog">]]></search>
			<!--<search position="after" regex="true" index="1"><![CDATA[~<\?php echo \$header; \?>|<div class="modal-dialog">~]]></search>-->
      <!-- <search position="after"><![CDATA[<?php echo $header; ?>]]></search> -->
			<ignoreif><![CDATA[// SET POIP SCRIPT AFTER HEADER]]></ignoreif>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php
        if (!empty($poip_installed)) {
					// SET POIP SCRIPT AFTER HEADER
          $poip_script = "";
        }
      ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
    
    <!-- PRODUCT OPTION SETTINGS : injection in middle of text, including js - line breaks inside of php is not allowed -->
    <operation >
      <search position="ibefore"><![CDATA[
      <label class="col-sm-2 control-label" for="input-required
      ]]></search>
      <add><![CDATA[<?php
      // Product Option Image PRO module <<
      if ( !empty($poip_installed) ) {
        $poip_html  = "<div poip_settings style=\"display: none; \">";
        $poip_html .= "<label class=\"col-sm-2 control-label\">".$poip_module_name."</label>";
				$poip_html .= "<div class=\"col-sm-10\">";
        //$poip_html .= "<a id=\"poip_settings_on\" onclick=\"poip_settings_toggle(this);\">".$entry_show_settings."</a>";
        //$poip_html .= "<a id=\"poip_settings_off\" onclick=\"poip_settings_toggle(this);\" style=\"display: none;\">".$entry_hide_settings."</a>";
        //$poip_html .= "<table id=\"poip_settings_values\" style=\"display: none;\">";
        foreach ($poip_settings_names as $poip_setting_name) {
          $poip_html .= "<div class=\"col-sm-4\" style=\"padding-left:0px;\">";
          $poip_entry_name = "entry_".$poip_setting_name;
          $poip_html .= "".$$poip_entry_name.":";
          $poip_html .= "";
          $poip_html .= "<select ".$poip_setting_name." class=\"form-control\">";
          // new
          if (in_array('entry_'.$poip_setting_name."_v0", $poip_settings_values)) {
            $poip_html .= "<option value=\"0\">".$poip_settings_select_options[0]."</option>";
            for ($i=1; $i<9; $i++) {
              if (in_array('entry_'.$poip_setting_name."_v".$i, $poip_settings_values)) {
                $poip_html .= "<option value=\"".(1+$i)."\">".${("entry_".$poip_setting_name."_v".$i)}."</option>";
              }
            }
            $poip_html .= "<option value=\"".(1)."\">".${("entry_".$poip_setting_name."_v0")}."</option>";
          } else {
            foreach ($poip_settings_select_options as $select_value => $select_name) {
              $poip_html .= "<option value=\"".$select_value."\">".$select_name."</option>";
            }
          }
          $poip_html .= "</select>";
          $poip_html .= "</div>";
        }
				$poip_html .= "</div>";
        $poip_html .= "</div>";
        $poip_html .= "</div><div class=\"form-group\">";
        echo $poip_html;
      }
      // >> Product Option Image PRO module
      ?>]]></add>
    </operation>
    
    
    
    <!-- show recently added options -->
    <operation>
      <search position="after"><![CDATA[
      $('#tab-option .tab-content').append(html);
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module << // new
      <?php  if ( !empty($poip_installed) ) {  ?>
        if (item['type'] == 'select' || item['type'] == 'radio' || item['type'] == 'checkbox' || item['type'] == 'image' || item['type'] == 'block' || item['type'] == 'color') {
          poip_refresh_settings();
        }
      <?php } ?>
      // >> Product Option Image PRO module 
      ]]></add>
    </operation>
    
    <!-- OPTION VALUES HEAD -->
    <operation error="skip">
      <search position="iafter"><![CDATA[
      <td class="text-right"><?php echo $entry_weight; ?></td>
      ]]></search>
      <add><![CDATA[<!-- Product Option Image PRO module << // new --><?php if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] ) { ?><td class="text-left" style="width:240px;"><?php echo $entry_image; ?></td><?php } ?><!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		<!-- OPTION VALUES HEAD comp with other developer RO extension -->
		<operation error="skip">
      <search position="iafter"><![CDATA[
      <td class="text-right relate-option"><?php echo $entry_weight; ?></td>
      ]]></search>
      <add><![CDATA[<!-- Product Option Image PRO module << // new --><?php if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] ) { ?><td class="text-left" style="width:240px;"><?php echo $entry_image; ?></td><?php } ?><!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		<!-- for openstock -->
		<operation error="skip">
      <search position="iafter"><![CDATA[
      <td class="text-right os-option-input"><?php echo $entry_weight; ?></td>
      ]]></search>
      <add><![CDATA[<!-- Product Option Image PRO module << // new --><?php if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] ) { ?><td class="text-left" style="width:240px;"><?php echo $entry_image; ?></td><?php } ?><!-- >> Product Option Image PRO module -->]]></add>
    </operation>
    
    <!-- OPTION VALUES ROWS -->
    <operation>
      <search position="after"><![CDATA[
      value="<?php echo $product_option_value['weight']; ?>"
      ]]></search>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php
        if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] ) {
          if (isset($product_option_value['images']) && is_array($product_option_value['images'])) {
            foreach ($product_option_value['images'] as $pov_image) {
              $poip_script .= "add_option_image(".$option_row.", $option_value_row, '".addslashes($pov_image['thumb'])."', '".addslashes($pov_image['image'])."', ".(int)$pov_image['srt'].");\n";
            }
          }
      ?>
      <td >
				<!-- <div style="margin: 6px; margin-bottom: 11px;">-->
					<button type="button" class="btn btn-default" onclick="add_option_image(<?php echo $option_row; ?>, <?php echo $option_value_row; ?>);" title="<?php echo $button_image_add; ?>">
						<i class="fa fa-plus-circle"></i>
					</button>
					<!-- </div> -->
				</a>
				<div id="option_images<?php echo $option_row; ?>_<?php echo $option_value_row; ?>"></div>
			</td>
      <?php
        }
      ?>
      <!-- >> Product Option Image PRO module -->
      ]]></add>
    </operation>
    
    <operation>
      <search position="after"><![CDATA[
      [product_option_value][' + option_value_row + '][weight]
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      <?php if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] ) { ?>
      html += '<td><button type="button" class="btn btn-default" onclick="add_option_image('+option_row+', '+option_value_row+');"><i class="fa fa-plus-circle"></i></button><div id="option_images'+option_row+'_'+option_value_row+'"></div></td>';
      <?php } ?>
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- OPTION VALUES TABLE BOTTOM ROW -->
    <operation>
      <search position="ibefore"><![CDATA[
      <td class="text-left"><button type="button" onclick="addOptionValue
      ]]></search>
      <add><![CDATA[<!-- Product Option Image PRO module << // new --><?php if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] ) { ?><td></td><?php } ?><!-- >> Product Option Image PRO module -->]]></add>
    </operation>
    
    
    
    <!-- SCRIPTS -->
    <operation >
      <search position="after"><![CDATA[
      var option_value_row
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      <?php
        if ( !empty($poip_installed) ) {
      ?>
      var option_image_row = 0;
      var poip_saved_settings = <?php echo json_encode($poip_saved_settings); ?>;
      
      function poip_settings_toggle(elem) {
        $(elem).toggle();
        $(elem).siblings('#poip_settings_values').toggle();
        $(elem).siblings('#poip_settings_on').toggle();
        $(elem).siblings('#poip_settings_off').toggle();
      }
      
      function poip_refresh_settings() {
        var poip_tabs = $('[id^=tab-option ]');
				var for_types = ['select','radio','checkbox','image','block','color'];
					
				for (var i=0;i<poip_tabs.length;i++) {
					if ($(poip_tabs[i]).find('input[type=hidden][name*=\\[type\\]]').length && $.inArray($(poip_tabs[i]).find('input[type=hidden][name*=\\[type\\]]').val(), for_types) != -1 ) {
						$(poip_tabs[i]).find('[poip_settings]').show();
					}
					var option_row = poip_tabs[i].id.substr(10);
					<?php  foreach ($poip_settings_names as $poip_setting_name) {  ?>
					$(poip_tabs[i]).find('[<?php echo $poip_setting_name; ?>]').attr('name', 'product_option['+option_row+'][poip_settings][<?php echo $poip_setting_name; ?>]');
					<?php  }  ?>
				}
				
				
      }
      
      function poip_fill_settings() {
        var poip_tabs = $('[id^=tab-option]');
        for (var i=0;i<poip_tabs.length;i++) {
          var option_row = poip_tabs[i].id.substr(10);
          if ($(poip_tabs[i]).find('[name=product_option\\['+option_row+'\\]\\[product_option_id\\]]').length) {
            var product_option_id = $(poip_tabs[i]).find('[name=product_option\\['+option_row+'\\]\\[product_option_id\\]]')[0].value;
            if (poip_saved_settings[product_option_id]) {
              <?php  foreach ($poip_settings_names as $poip_setting_name) {  ?>
                if (poip_saved_settings[product_option_id]['<?php echo $poip_setting_name; ?>']) {
                  $(poip_tabs[i]).find('[<?php echo $poip_setting_name; ?>]').val(poip_saved_settings[product_option_id]['<?php echo $poip_setting_name; ?>']);
                }
              <?php  }  ?>
            }
          }
        }
      }
      
      function add_option_image(option_row, option_value_row, thumb, image, srt) {

        
        html = '';
        
        html += '<div id="div_option_image'+option_image_row+'" style="float:left;">';
				//html += '<div class="image" style="margin: 2px; padding: 5px;  width:100px;" id="div_option_image'+option_image_row+'">';
        if (image && thumb) {
          var current_thumb = thumb;
          var current_image = image;
          var current_srt = srt;
        } else {
          var current_thumb = '<?php echo $placeholder; ?>';
          var current_image = '';
          var current_srt = 0;
          $('#option_images'+option_row+'_'+option_value_row).find('[name*=\\[srt\\]]').each(function() {
            current_srt = Math.max(current_srt, (parseInt(this.value)?parseInt(this.value):0));
          });
          current_srt++;
        }
				
				
				html += '<a href="" id="thumb-option-image'+option_image_row+'" data-toggle="image" class="img-thumbnail" >';
				html += '<img height="100" width="100" src="'+current_thumb+'" alt="" title="" data-placeholder="<?php echo $placeholder; ?>">';
				html += '</a>';
				html += '<input type="hidden" id="option_image'+option_image_row+'" name="product_option[' + option_row + '][product_option_value][' + option_value_row + '][images]['+option_image_row+'][image]" value="'+current_image+'">';
				html += '<div>';
				html += '<input  type="text" class="form-control" style="width:72px;float:left;" title="<?php echo $entry_sort_order; ?>" name="product_option[' + option_row + '][product_option_value][' + option_value_row + '][images]['+option_image_row+'][srt]" value="'+current_srt+'" size="3">';
				html += '<button class="btn btn-default" title="<?php echo $button_remove; ?>" onclick="$(\'#div_option_image' + option_image_row + '\').remove();"><i class="fa fa-trash-o"></i></button>';
				html += '</div>';
				
        html += '</div>';
        
        $('#option_images'+option_row+'_'+option_value_row).append(html);
        
        option_image_row++;
        
      }
      
      $(document).ready(function(){
        
        <?php
          echo $poip_script;
        ?>
        poip_fill_settings();
        poip_refresh_settings();
        
      });
      
      
      <?php
        }
      ?>
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    
  </file>
  


	
	<file name="admin/controller/sale/order.php">
		<operation >
      <search position="after" error="log"><![CDATA[
      $options = $this->model_sale_order->getOrderOptions(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
			if ( !empty($product['product_id']) ) {
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$poip_installed = $this->model_module_product_option_image_pro->installed();
				if ($poip_installed) {
					if (isset($product['img'])) {
						$product['img'] = array('image'=>$this->model_module_product_option_image_pro->getProductOrderImage($product['product_id'], $options, (isset($product['img']['image'])) ? $product['img']['image'] : $product['img'] ));
					}
					// compatibility with extensions showing product images on order info page
					if ( isset($image) && $this->config->get($this->config->get('config_theme') . '_image_cart_width') && $this->config->get($this->config->get('config_theme') . '_image_cart_height') ) {
						$poip_image = $this->model_module_product_option_image_pro->getProductOrderImage($product['product_id'], $options, '' );
						if ($poip_image) {
							$image = $this->model_tool_image->resize($poip_image, $this->config->get($this->config->get('config_theme') . '_image_cart_width'), $this->config->get($this->config->get('config_theme') . '_image_cart_height'));
						}
					}
				}
			}
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
	</file>

	<!-- Product Images in Order Info Page && Product Images in Invoice -->
  <file name="admin/controller/sale/order.php">
		<operation error="skip">
			<search position="before"><![CDATA[
			$thumb = $this->model_tool_image->resize($image, 60, 60);
			]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $image = $this->model_module_product_option_image_pro->getProductOrderImage((int)$product['product_id'], $options, $image);
      // >> Product Option Image PRO module
			]]></add>
		</operation>
  </file>
	
	<file name="admin/view/template/common/footer.tpl" error="log">
		
		<operation error="skip">
			<search position="after"><![CDATA[$('#button-image').on('click', function() {]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
			$('[id^="div_option_image"]').removeAttr('data-poip-fm-active');
			if ( $(this).parent().parent().parent().is('[id^="div_option_image"]') ) {
				$(this).parent().parent().parent().attr('data-poip-fm-active', true);
			}
			// >> Product Option Image PRO
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="after"><![CDATA[$(document).delegate('a[data-toggle=\'manager\']', 'click', function(e) {]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
			$('[id^="div_option_image"]').removeAttr('data-poip-fm-active');
			if ( $(this).parent().parent().parent().is('[id^="div_option_image"]') ) {
				$(this).parent().parent().parent().attr('data-poip-fm-active', true);
			}
			// >> Product Option Image PRO
			]]></add>
		</operation>
		
  </file>

<!-- ****************** FRONTEND ******************** -->

	
  <file name="catalog/model/catalog/product.php">  
    
    <operation >
      <search position="after"><![CDATA[
      public function getProductOptions($product_id) {
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $poip_installed = $this->model_module_product_option_image_pro->installed();
      if ($poip_installed) {
        $product_options_images = $this->model_module_product_option_image_pro->getProductOptionImages($product_id, false, false);
        $product_options_settings = $this->model_module_product_option_image_pro->getProductSettings($product_id);
      }
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation >
      <search position="after"><![CDATA[
      $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_image WHERE product_id
      ]]></search>
      <add><![CDATA[
			
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $query->rows = $this->model_module_product_option_image_pro->addMainProductImageToAdditional($product_id, $query->rows);
      //$this->model_module_product_option_image_pro->addMainProductImageToAdditional($product_id, array(&$query->rows));
      //$this->model_module_product_option_image_pro->addMainProductImageToAdditional($product_id, $query->rows);
      
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
    
    <operation >
      <search position="after"><![CDATA[
      foreach ($product_option_value_query->rows as $product_option_value) {
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ($poip_installed) {
        if ( isset($product_options_settings[(int)$product_option['product_option_id']]['img_first']) && $product_options_settings[(int)$product_option['product_option_id']]['img_first'] ) {
          if ( isset($product_options_images[(int)$product_option['product_option_id']][$product_option_value['product_option_value_id']][0]['image'])) {
            $product_option_value['image'] = $product_options_images[(int)$product_option['product_option_id']][$product_option_value['product_option_value_id']][0]['image'];
          }
        }
				if ( isset($product_options_settings[(int)$product_option['product_option_id']]['img_radio_checkbox']) && $product_options_settings[(int)$product_option['product_option_id']]['img_radio_checkbox'] ) {
					
					$product_option_value['poip_image'] = $product_option_value['image'];
				
					if ( isset($product_options_settings[(int)$product_option['product_option_id']]['img_first']) && $product_options_settings[(int)$product_option['product_option_id']]['img_first'] ) {
						if ( isset($product_options_images[(int)$product_option['product_option_id']][$product_option_value['product_option_value_id']][0]['image'])) {
							$product_option_value['poip_image'] = $product_options_images[(int)$product_option['product_option_id']][$product_option_value['product_option_value_id']][0]['image'];
						}
					}
        }
      }
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation >
      <search position="after"><![CDATA[
      $product_option_value_data[] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      'poip_image'                   => isset($product_option_value['poip_image']) ? $product_option_value['poip_image'] : '',
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
    
  </file>
    
	<!-- catalog/controller/themecontrol/product.php - pav fashion -->
  <file name="catalog/controller/product/product.php,catalog/controller/product/quickview.php,catalog/controller/welldone/quickview.php,catalog/controller/themecontrol/product.php,catalog/controller/journal2/quickview.php" error="skip">  
    
    <operation >
      <search position="after"><![CDATA[
      $data['images'][] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      'title' => isset($result['title']) ? $result['title'] : '',
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation >
      <search position="after"><![CDATA[
      $results = $this->model_catalog_product->getProductImages($this->request->get['p
      ]]></search>
      <add><![CDATA[
			
      // Product Option Image PRO module <<
			// $this->request->get['pid'] - journal2 quickview
			//$poip_product_id = !(isset($this->request->get['product_id'])) ? $this->request->get['pid'] : $this->request->get['product_id'];
      if ( isset($this->request->get['product_id']) ) {
        $poip_product_id = $this->request->get['product_id'];
      } elseif ( isset($this->request->get['pid']) ) {
        $poip_product_id = $this->request->get['pid'];
      } else {
        $poip_product_id = $this->request->get['prod_id'];
      }
			
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
			$data['poip_inclide_file_name_default'] = $this->model_module_product_option_image_pro->getTemplateIncludeFileName('product', true);
			$data['poip_inclide_file_name_custom'] = $this->model_module_product_option_image_pro->getTemplateIncludeFileName('product');
			
			$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			if ( $data['poip_theme_name'] == 'journal2' ) {
				$data['poip_journal2_settings'] = array();
				$data['poip_journal2_settings']['product_page_gallery_carousel_arrows'] = $this->journal2->settings->get('product_page_gallery_carousel_arrows');
				$data['poip_journal2_settings']['product_page_gallery'] = $this->journal2->settings->get('product_page_gallery');
				$data['poip_journal2_settings']['product_grid_wishlist_icon_position'] = $this->journal2->settings->get('product_grid_wishlist_icon_position');
			} elseif ( $data['poip_theme_name'] == 'mattimeo' ) {
				$data['poip_mattimeo_settings'] = array();
				$data['poip_mattimeo_settings']['product_zoom'] = $this->config->get('product_zoom');
			} elseif ( $data['poip_theme_name'] == 'moneymaker' ) {
				$data['poip_moneymaker_settings'] = array();
				$data['poip_moneymaker_settings']['mmr_product_gallery_type'] = $this->config->get('mmr_product_gallery_type');
			}
			
			// marketshop compatibility
			if ($this->config->has('marketshop_cloud_zoom_gallery')) {
				$data['marketshop_cloud_zoom_gallery'] = $this->config->get('marketshop_cloud_zoom_gallery');
			}
			
			
			$data['current_class'] = 'related_products';
      if ($data['poip_installed']) {
        $data['poip_product_settings'] = $this->model_module_product_option_image_pro->getProductSettings($poip_product_id);
        $data['poip_settings'] = $this->model_module_product_option_image_pro->getSettings();
        
        $poip_results = $this->model_module_product_option_image_pro->addOptionImagesToProductImages($results, $poip_product_id, array() );
        $results = $poip_results['results'];
        $product_images = $poip_results['product_images'];
        //$product_images = array();
        //$results = $this->model_module_product_option_image_pro->addOptionImagesToProductImages($results, $poip_product_id, array(&$product_images));
        //$results = $this->model_module_product_option_image_pro->addOptionImagesToProductImages($results, $poip_product_id, $product_images);
        $data['poip_images'] = $product_images;
        $data['poip_product_option_ids'] = $this->model_module_product_option_image_pro->getProductOptionsIdsWithImages($product_images);
        $data['poip_images_by_options'] = $this->model_module_product_option_image_pro->getProductOptionImagesByValues($poip_product_id);
        
				if (isset($_GET['poip_ov'])) {
					if ($_GET['poip_ov']) {
						$data['poip_ov'] = $_GET['poip_ov'];
					}
				} elseif ( isset($_SERVER['REQUEST_URI']) ) {
				
					$poip_ov_name = "poip_ov=";
					if (strpos($_SERVER['REQUEST_URI'], $poip_ov_name) !== false) {
					
						$poip_str = substr($_SERVER['REQUEST_URI'], strpos($_SERVER['REQUEST_URI'], $poip_ov_name)+strlen($poip_ov_name));
						$poip_ov = "";
						while ($poip_str != "" && strpos("0123456789", substr($poip_str, 0, 1))!==false ) {
							$poip_ov.= substr($poip_str, 0, 1);
							$poip_str = substr($poip_str, 1);
						}
						if ($poip_ov != "") {
							$data['poip_ov'] = $poip_ov;
						}
					}
				}
				
				// не работает на mijoshop
				//$data['poip_ov'] = isset($this->request->get['poip_ov']) ? (int)$this->request->get['poip_ov'] : false;
				
        
      }
      //>> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- related products -->
		<operation error="skip">
      <search position="after" ><![CDATA[
      $data['products'][] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( $result['product_id'], "related_products" ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- related products (j2 and others themes images swipe: product image to first additional image ) -->
		<operation error="skip">
      <search position="after"><![CDATA[
      $image2 = $this->model_tool_image->resize($additional_images[0]['image']
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($additional_images) > 1 && ($image2 == $image || $result['image'] == $additional_images[0]['image'] ) ) {
				$image2 = $this->model_tool_image->resize($additional_images[1]['image'], $this->config->get('config_image_product_width'), $this->config->get('config_image_product_height'));
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
  </file>
  
	<!-- pav fashion theme compatibility - fix -->
	<file name="catalog/view/theme/*/template/themecontrol/product.tpl">
		<operation error="skip">
      <search position="before"><![CDATA[</body></html>]]></search>
      <add><![CDATA[
      <?php /* <?php echo $footer; ?> */ ?>
      ]]></add>
    </operation> 
	</file>
	
	<!-- for related products -->	
	<file name="catalog/view/theme/*/template/product/product.tpl">
		<!-- related products -->
		<operation error="skip">
      <search position="ibefore"><![CDATA[
      alt="<?php echo $product['name'];
      ]]></search>
      <add><![CDATA[<?php /* Product Option Image PRO module << */ if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   /*  >> Product Option Image PRO module */ ?>]]></add>
    </operation>
		
		<!-- lexus_shopping -->
		<operation error="skip">
      <search position="ireplace"><![CDATA[require( PAVO_THEME_DIR."/template/product/products_related.tpl" );]]></search>
      <add><![CDATA[
			/* Product Option Image PRO module << */
			if (!empty($poip_installed)) {
				require( VQMod::modCheck( PAVO_THEME_DIR."/template/product/products_related.tpl" ) );
			} else {
				require( PAVO_THEME_DIR."/template/product/products_related.tpl" );
			}
			/*  >> Product Option Image PRO module */
			]]></add>
    </operation>
		
		<operation error="skip">

			<!-- MORE? compatible -->
			<search position="after"><![CDATA[
      <a href="<?php echo $product['href']; ?>"><img
      ]]></search>

      <add><![CDATA[
      
      <?php // Product Option Image PRO module << ?>
			
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images']) {
			
				foreach ($product['option_images'] as $product_option_id => $option_images) {
						
					if ($poip_theme_name == "sellegance" || $poip_theme_name == "theme422"
						|| $poip_theme_name == "polianna" || $poip_theme_name == "moneymaker"
						 ) {
						
						echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; \">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a ". ($poip_theme_name!="mattimeo" ? "onmouseover=\"poip_show_thumb(this);\"" : "") ."
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
										";
						}
						echo "</div>";

					} elseif ($poip_theme_name == "pav_styleshop") { // for product_module.tpl
						// just skip
						
					
					
					} else { // OC 2.0 new style default
					
						echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; margin-top: 3px; \">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a onmouseover=\"poip_show_thumb(this);\" 
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
										";
						}
						echo "</div>";
					}
				}
				
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
	</file>
  
  <!-- art theme new slider version should be uploaded (slick.min.js) instead of older version included in general_scripts.js -->
	<file name="catalog/view/theme/art/template/common/header.tpl" error="skip">
		
		<operation error="skip">
      <search position="after"><![CDATA[
      <script src="catalog/view/theme/<?php echo $config->get('config_template'); ?>/js/general_scripts.js" type="text/javascript"></script>
      ]]></search>
      <add><![CDATA[
			<script src="catalog/view/theme/<?php echo $config->get('config_template'); ?>/js/slick.min.js" type="text/javascript"></script>
      ]]></add>
    </operation>  
		
	</file>
	
	<!-- coolbaby theme new slider version should be uploaded (slick.min.js) instead of older version included in general_scripts.js -->
	<file name="catalog/view/theme/coolbaby/template/common/header.tpl" error="skip">
		
		<operation error="skip">
      <search position="after"><![CDATA[
			<script src="catalog/view/theme/<?php echo $config->get('config_theme'); ?>/js/general_scripts.js" type="text/javascript"></script>
      ]]></search>
      <add><![CDATA[
			<script src="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.min.js" type="text/javascript"></script>
      ]]></add>
			<!--
			<script src="catalog/view/theme/<?php echo $config->get('config_template'); ?>/js/slick.min.js" type="text/javascript"></script>
			-->
    </operation>  
		
	</file>
	
	<!-- sebian quickview fix  -->
	<file name="catalog/view/theme/sebian/template/product/quickview.tpl" error="skip">
		<operation error="skip"> 
			<search position="after" offset="20"><![CDATA[
      $("#image-additional-carousel-quickview").owlCarousel({
      ]]></search> 
      <add><![CDATA[
			<?php /* Product Option Image PRO for sebian quickview <?php echo $footer; ?> */  ?>
      ]]></add>	
		</operation>
	</file>
	
	<!-- moneymaker2 -->
	<file name="catalog/view/theme/moneymaker2/template/product/product.tpl" error="skip">
		<operation error="skip">
      <search position="replace" ><![CDATA[
				$('.thumbnails').magnificPopup({
			]]></search>
      <add><![CDATA[
				// poip replacement
				$('.thumbnails.image-additional').magnificPopup({
				//$('.thumbnails').magnificPopup({
			]]></add>
    </operation>
	</file>
	
	<!-- aspire quickview fix  -->
	<file name="catalog/view/theme/*/template/product/quickview.tpl" error="skip">
		<operation error="skip"> 
			<search position="before" index="1"><![CDATA[
      <script type="text/javascript"><!--
      ]]></search>
			<ignoreif><![CDATA[echo $footer;]]></ignoreif>
      <add><![CDATA[
			
			<?php /* Product Option Image PRO for sebian quickview <?php echo $footer; ?> */  ?>
			
      ]]></add>	
		</operation>
	</file>
	
	<!-- sebian theme quickview - catalog/view/theme/*/template/product/quickview.tpl -->
	<file name="catalog/view/theme/*/template/product/product.tpl,catalog/view/theme/*/template/welldone/quickview.tpl,catalog/view/theme/*/template/product/quickview.tpl,catalog/view/theme/*/template/themecontrol/product.tpl,catalog/view/theme/*/template/journal2/quickview/quickview.tpl">
	<!-- <file name="catalog/view/theme/*/template/product/product.tpl"> -->
    
		<!-- disable sstore theme own image changer -->
		<operation error="skip">
      <search position="before" offset="1"><![CDATA[
      url: 'index.php?route=product/product/getPImages&product_id=<?php echo $product_id; ?>',
      ]]></search>
      <add><![CDATA[
			<?php
        // << Product Option Image PRO module
        if ( !empty($poip_installed) ) echo "return;"; 
        // >> Product Option Image PRO module
      ?>
      ]]></add>
    </operation>
		
    <!-- pav styleshop -->
		<operation error="skip">
      <search position="after" index="1" offset="1" ><![CDATA[
      galleryActiveClass: "active"
      ]]></search>
      <add><![CDATA[
        // << Product Option Image PRO module
        var poip_elevate_zoom_object = $( zoomCollection ).data('elevateZoom');
        // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation error="skip">
      <search position="replace"><![CDATA[
      src="<?php echo $image['thumb']; ?>" title="<?php echo $heading_title; ?>" alt="<?php echo $heading_title; ?>"
      ]]></search>
      <add><![CDATA[
      src="<?php echo $image['thumb']; ?>" title="<?php echo ( (isset($image['title']) && $image['title']) ? ' '.$image['title'] : $heading_title); ?>" alt="<?php echo ((isset($image['title']) && $image['title']) ? ' '.$image['title'] : $heading_title); ?>"
      ]]></add>
    </operation>
		
		<!-- pav fashion - related products -->
		<operation error="skip">
			<search position="after" ><![CDATA[
      <div class="warp-info">
      ]]></search>

      <add><![CDATA[
      
      <?php // Product Option Image PRO module << ?>
			
			<?php  if ( !empty($poip_installed) && isset($product['option_images']) && $product['option_images']) {
			
        foreach ($product['option_images'] as $product_option_id => $option_images) {
				
          //opacity: .99; float:left; 
					echo "<div data-poip_id='poip_img' style='width:100%; display: table-cell;  position:relative; top:-6px; z-index: 1000;'>";
					$image_counter = 0;
          foreach ($option_images as $product_option_value_id => $option_image) {
						$image_counter++;
									
							echo "			 
                    <a style=\"margin:0px; margin-left:2px; margin-bottom:2px;  float:left; \" onmouseover=\"poip_show_thumb(this);\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
                      ".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
                      data-thumb=\"".$option_image['thumb']."\"
                      data-image_id=\"".$current_class."_".$product['product_id']."\">
                    <img style=\"\" src=\"".$option_image['icon']."\"></a>
                   ";		
									
          }
					echo "</div>";
        }
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- pav fashion theme script for related products -->
		<operation error="skip">
			<search position="before"><![CDATA[
      <?php echo $footer; ?>
      ]]></search>
      <add><![CDATA[
			<?php
				//<< Product Option Image PRO module
				if (isset($poip_theme_name) && ($poip_theme_name=='pav_fashion' || $poip_theme_name=='fashion' || $poip_theme_name=='pav_styleshop' || $poip_theme_name=='megashop'
				|| $poip_theme_name == 'lexus_shopping' || $poip_theme_name == 'pav_sportshop' ) ) { ?>
				<script type="text/javascript"><!--
					$('div.product-action').css('top', '-70px');
					$('a.pav-colorbox').css('top', 'auto');
					$('a.pav-colorbox').css('bottom', '-40px');
				--></script>
				<?php }
				// >> Product Option Image PRO module
				?>
      ]]></add>	
		</operation>
		
		<!-- pav fashion product details -->
		<operation error="skip">
			<search position="replace"><![CDATA[
      <?php require( PAVO_THEME_DIR."/template/product/product_detail_hitech.tpl" );  ?>
      ]]></search>
      <add><![CDATA[
			<?php
				if ( class_exists('VQMod') ) {
					require( VQMod::modCheck( PAVO_THEME_DIR."/template/product/product_detail_hitech.tpl" ) );
				} else {
					require( PAVO_THEME_DIR."/template/product/product_detail_hitech.tpl" );
				}
			?>
      ]]></add>	
		</operation>
		
		<!-- journal2 quickview -->
		
		<!-- pav fashion theme script for related products -->
		<operation error="skip">
			<search position="after" offset="1"><![CDATA[
      <html class="product-page quickview
      ]]></search>
      <add><![CDATA[
			<!-- << Product Option Image PRO module -->
				<script type="text/javascript"><!--
					var poip_journal2_quickview = true;
				--></script>
			<!-- >> Product Option Image PRO module -->
      ]]></add>	
		</operation>
		
	
		<!-- Pavilion костыль  -->
		<operation error="skip"> 
			<search position="before" ><![CDATA[
      <article id="product" class="tb_<?php echo $tbData->product_layout_design_id; ?>" itemscope itemtype="http://schema.org/Product">
      ]]></search> 
      <add><![CDATA[
			<?php /* Product Option Image PRO for Pavilion <?php echo $footer; ?> */  ?>
      ]]></add>	
		</operation>
		
		
		
		<!-- SCRIPT -->
    <operation > 
			<!-- </body> for journal2 quickview <\?php \$tbData->echoFooter\(\$footer\); \?> -->
      <search position="before" index="1" regex="true"><![CDATA[~echo \$footer;|</body>~]]></search>
			
			<!-- 
			<search position="before"><![CDATA[
      <?php echo $footer; ?>
      ]]></search>
			-->
			
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php
				if ( !empty($poip_installed) ) {  
					
					if ( !empty($poip_inclide_file_name_default) ) {
						if (class_exists('VQMod')) {
							include( VQMod::modCheck( modification($poip_inclide_file_name_default) ) );
						} else {
							include( modification($poip_inclide_file_name_default) );
						}
					}
					if ( !empty($poip_inclide_file_name_custom) ) {
						if (class_exists('VQMod')) {
							include( VQMod::modCheck( modification($poip_inclide_file_name_custom) ) );
						} else {
							include( modification($poip_inclide_file_name_custom) );
						}
					} else { // no custom (owerwise it was created in custom file)
						?>
						<script  type = "text/javascript" ><!--
							if ( typeof(poip_product_default) != 'undefined' ) { 
								var poip_product = new poip_product_default();
							}
						//--></script>
						<?php
					}
					
				}
			?>
      <!-- >> Product Option Image PRO module -->
      ]]></add>
    </operation>
    
    
    <!-- shoppystore (so-shoppystore) theme compatibility -->
    <operation error="skip">
      <search position="after"><![CDATA[
      <?php $i=-1; foreach ($images as $image) :$i++ ?>
      ]]></search>
      <add><![CDATA[
      <?php if ( substr($poip_theme_name, 0, 14) == 'so-shoppystore' ) {
      // Product Option Image PRO module <<
      // to not show the same image twice
      if ( !isset($poip_shown_imgs) ) $poip_shown_imgs = array();
      if ( in_array($image['popup'], $poip_shown_imgs) ) continue;
      $poip_shown_imgs[] = $image['popup'];
      
      // >> Product Option Image PRO module
      } ?>
      ]]></add>
    </operation>
    
    
    <!-- goshop & fastor, and some other themes compatibility -->
    <operation error="skip">
      <search position="after"><![CDATA[
      <?php foreach ($images as $image) { ?>
      ]]></search>
      <add><![CDATA[
      <?php if ( ($poip_theme_name == 'goshop'
							|| ($poip_theme_name == 'fastor' && $theme_options->get( 'product_image_zoom' ) != 2)
							|| $poip_theme_name == 'journal2'
							|| $poip_theme_name == 'OPC080191'
							|| $poip_theme_name == 'BurnEngine_pavilion'
							|| $poip_theme_name == 'BurnEngine_technopolis'
							|| $poip_theme_name == 'BurnEngine_shoppica'
							) && !empty($poip_installed) && !empty($popup)  ) {
      // Product Option Image PRO module <<
      // to not show the main image twice
      if ( $image['popup'] == $popup ) continue;
      // >> Product Option Image PRO module
      } ?>
      ]]></add>
    </operation>
    
  </file>
  

  
  <!-- FilterPRO compatibility -->
  <file name="catalog/controller/module/filterpro.php" error="skip">  
    
    <operation error="log">
      <search position="after" offset="1"><![CDATA[
      private function getHtmlProducts($results, $product_total)
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $data['current_class'] = str_replace("Controller", "", get_class($this));
			$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
      
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation >
      <search position="after"><![CDATA[
      $data['products'][] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>
	
	
	<!-- pav fashion theme compatibility -->
	<file name="catalog/controller/module/pavproducttabs.php" error="skip">  
		
		<operation >
      <search position="before" error="skip"><![CDATA[
      $data['tabs'] = $tabs;
      ]]></search>
      <add><![CDATA[
      // << Product Option Image PRO module
			if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
			$data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $data['current_class'] = str_replace("Controller", "", get_class($this));
			$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
      if ($data['poip_installed'] && $tabs && is_array($tabs)) {
				
				foreach ($tabs as &$products_tab) {
					if ($products_tab && is_array($products_tab)) {
						foreach ($products_tab as &$product) {
							if (isset($product['product_id']) && $product['product_id']) {
								$product['option_images'] = $this->model_module_product_option_image_pro->getCategoryImages($product['product_id'], false);
							}
						}
						unset($product);
					}
					unset($products_tab);
				}
      }
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- pav megashop -->
		<operation >
      <search position="before" error="skip"><![CDATA[
      $this->data['tabs'] = $tabs;
      ]]></search>
      <add><![CDATA[
      // << Product Option Image PRO module
			if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
			$this->data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $this->data['current_class'] = str_replace("Controller", "", get_class($this));
			$this->data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
      if ($this->data['poip_installed'] && $tabs && is_array($tabs)) {
				
				foreach ($tabs as &$products_tab) {
					if ($products_tab && is_array($products_tab)) {
						foreach ($products_tab as &$product) {
							if (isset($product['product_id']) && $product['product_id']) {
								$product['option_images'] = $this->model_module_product_option_image_pro->getCategoryImages($product['product_id'], false);
							}
						}
						unset($product);
					}
					unset($products_tab);
				}
      }
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
	</file>
  
	<!-- lexus_shopping - pav deals -->
	<file name="catalog/controller/pavdeals/deals.php" error="skip">
	
		 <operation >
      <search position="before"><![CDATA[
      $this->load->model('catalog/product');
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->mdata['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $this->mdata['current_class'] = str_replace("Controller", "", get_class($this));
			$this->mdata['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			
      
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
	
		<operation error="skip">
      <search position="after"><![CDATA[
      $products[] = $this->getItemDeal($result, $setting);
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      $products[count($products)-1]['option_images'] = $this->model_module_product_option_image_pro->getCategoryImages( $result['product_id'],
        (isset($data['current_class']) && $this->mdata['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  );
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
	</file>
	
	<!-- lexus_shopping -->
	<file name="catalog/controller/module/pavproductcarousel.php" error="skip">  
    
    <operation >
      <search position="before"><![CDATA[
      $this->load->model('catalog/product');
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $this->data['current_class'] = str_replace("Controller", "", get_class($this));
			$this->data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      'product_id' => $result['product_id'],
      ]]></search>
			<ignoreif><![CDATA[$data['products'][] = array(]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( $result['product_id'], (isset($this->data['current_class']) && $this->data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $thumb2 = $this->model_tool_image->resize($product_images[0]['image'], $setting['width'], $setting['height']);
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($product_images) > 1 && $thumb2 == $image) {
				$thumb2 = $this->model_tool_image->resize($product_images[1]['image'], $setting['width'], $setting['height']);
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $image = 
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			$thumb2 = false;
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
	</file>
	
	<!-- lexus_shopping -->
	<file name="catalog/controller/module/pavcategorytabs.php" error="skip">  
    
    <operation >
      <search position="before"><![CDATA[
      $this->load->model('catalog/product');
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->mdata['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $this->mdata['current_class'] = str_replace("Controller", "", get_class($this));
			$this->mdata['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
			'product_id'  => $result['product_id'],
      ]]></search>
			<ignoreif><![CDATA[$data['products'][] = array(]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( $result['product_id'], (isset($this->mdata['current_class']) && $this->mdata['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      'product_id' => $product_info['product_id'],
      ]]></search>
			<ignoreif><![CDATA[$data['products'][] = array(]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( $product_info['product_id'], (isset($this->mdata['current_class']) && $this->mdata['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $thumb2 = $this->model_tool_image->resize($product_images[0]['image'], $setting['width'], $setting['height']);
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($product_images) > 1 && $thumb2 == $image) {
				$thumb2 = $this->model_tool_image->resize($product_images[1]['image'], $setting['width'], $setting['height']);
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $image = 
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			$thumb2 = false;
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
		
	</file>
	
  <!-- filter_product.php - eagency theme -->
  <file path="catalog/controller/" name="product/category.php,module/mega_filter.php,module/filter_product.php,product/search.php,product/special.php,product/manufacturer.php,module/latest.php,module/bestseller.php,module/special.php,module/featured.php,extension/module/latest.php,extension/module/bestseller.php,extension/module/special.php,extension/module/featured.php" error="skip">  
    
    <operation >
      <search position="before"><![CDATA[
      $this->load->model('catalog/product');
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $data['current_class'] = str_replace("Controller", "", get_class($this));
			$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			$data['poip_cosyone_rollover_effect'] = $this->config->get('cosyone_rollover_effect');
      
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation error="skip">
      <search position="after"><![CDATA[
      $data['products'][] = array(
      ]]></search>
			<ignoreif><![CDATA[Template: EAGENCY]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( isset($result['product_id']) ? $result['product_id'] : (isset($product_info['product_id'])?$product_info['product_id']:0),
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- << marketshop_product_tab.php -->
		<operation error="skip">
      <search position="after"><![CDATA[
      $data['latest_products'][] = array(
      ]]></search>
			<ignoreif><![CDATA[Template: EAGENCY]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
		</operation>
		<operation error="skip">
      <search position="after"><![CDATA[
      $data['bestseller_products'][] = array(
      ]]></search>
			<ignoreif><![CDATA[Template: EAGENCY]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
		</operation>
		<operation error="skip">
      <search position="after"><![CDATA[
      $data['special_products'][] = array(
      ]]></search>
			<ignoreif><![CDATA[Template: EAGENCY]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
		</operation>
		<!-- >> marketshop_product_tab.php -->
		
		
		<!-- eagency theme  -->
		<operation error="skip">
      <search position="after"><![CDATA[
      'product_id' => $result['product_id'],
      ]]></search>
			<ignoreif><![CDATA[$data['products'][] = array(]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( $result['product_id'], (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- eagency theme -->
		<operation error="skip">
      <search position="after"><![CDATA[
      'product_id' => $product_info['product_id'],
      ]]></search>
			<ignoreif><![CDATA[$data['products'][] = array(]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( $product_info['product_id'], (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
    <!-- opc1000 theme - category.php -->
    <operation error="skip">
      <search position="after"><![CDATA[
      $image_2 = $this->model_tool_image->resize($images[0]['image'], $this->config->get('config_image_product_width'), $this->config->get('config_image_product_height'));
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($images) > 1 && $image_2 == $image) {
				$image_2 = $this->model_tool_image->resize($images[1]['image'], $this->config->get('config_image_product_width'), $this->config->get('config_image_product_height'));
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- opc1000 - featured.php etc -->
    <operation error="skip">
      <search position="after"><![CDATA[
      $image_2 = $this->model_tool_image->resize($images[0]['image'], $setting['width'], $setting['height']);
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($images) > 1 && $image_2 == $image) {
        $image_2 = $this->model_tool_image->resize($images[1]['image'], $setting['width'], $setting['height']);
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    
    <operation error="skip">
      <search position="after"><![CDATA[
      $image2 = $this->model_tool_image->resize($additional_images[0]['image']
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($additional_images) > 1 && $image2 == $image) {
				$image2 = $this->model_tool_image->resize($additional_images[1]['image'], $this->config->get('config_image_product_width'), $this->config->get('config_image_product_height'));
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
    
  </file>
	
	<!-- marketshop_product_tab.php -->
	<file name="catalog/controller/module/marketshop_product_tab.php" error="skip">  
    
    <operation >
      <search position="before"><![CDATA[
      $this->load->model('catalog/product');
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
			if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $data['current_class'] = str_replace("Controller", "", get_class($this));
			$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			$data['poip_cosyone_rollover_effect'] = $this->config->get('cosyone_rollover_effect');
      
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation error="skip">
      <search position="after"><![CDATA[
      $data['products'][] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( $product_info['product_id'], (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $data['latest_products'][] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
		</operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $data['bestseller_products'][] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
		</operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $data['special_products'][] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
		</operation>
		
    
  </file>
	
	<!-- journal2 compatibility -->
	<file name="catalog/controller/module/journal2_custom_sections.php,catalog/controller/module/journal2_carousel.php" error="skip"> 
    
		<!-- $this->template = "journal2/template/journal2/module/carousel -->
		<!-- 			$this->template = $this->config->get('config_template') . "/template/journal2/module/carousel_{$this->data['module_type']}.tpl"; -->
    <!-- template/journal2/module/custom_sections_ -->
    <operation error="log">
      <search position="before" regex="true"><![CDATA[~journal2/module/custom_sections_|journal2/module/carousel_~]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
			$this->data['current_class'] = str_replace("Controller", "", get_class($this));
			$this->data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			
      if ( !empty($this->data['sections']) ) {
				foreach ($this->data['sections'] as &$section) {
					if (isset($section['items'])) {
						foreach ($section['items'] as &$product) {
							if (isset($product['product_id'])) {
								$product['option_images'] = $this->model_module_product_option_image_pro->getCategoryImages( $product['product_id'], false  );
							}
						}
					}
				}
			}
			unset($section);
			unset($product);
      
			if ( !empty($this->data['items']) ) {
				foreach ($this->data['items'] as &$product) {
					if ( !empty($product['product_id']) ) {
						$product['option_images'] = $this->model_module_product_option_image_pro->getCategoryImages( $product['product_id'], false  );
					}
				}
			}
			unset($product);
      
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation error="skip">
      <search position="after"><![CDATA[
      $image2 = Journal2Utils::resizeImage($this->model_tool_image, $results[0]['image']
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($results) > 1 && $image2 == $image) {
				$image2 = Journal2Utils::resizeImage($this->model_tool_image, $results[1]['image'] ? $results[1]['image'] : 'data/journal2/no_image_large.jpg', $this->data['image_width'], $this->data['image_height'], $this->data['image_resize_type']);
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>
	
	<!-- journal2 compatibility -->
	<file name="catalog/controller/module/journal2_super_filter.php" error="skip">  
    
		<!-- $this->template = 'journal2/template/journal2/module/super_filter_product.tpl'; -->
    <!-- template/journal2/module/super_filter_product.tpl'; -->
    <operation error="log">
      <search position="before"><![CDATA[
			journal2/module/super_filter_product
      ]]></search>
      <add><![CDATA[

      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $this->data['current_class'] = str_replace("Controller", "", get_class($this));
			$this->data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			foreach ($this->data['products'] as &$product) {
				$product['option_images'] = $this->model_module_product_option_image_pro->getCategoryImages( $product['product_id'],
					(isset($this->data['current_class']) && $this->data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  );
			}
			unset($product);
      
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation error="skip">
      <search position="after"><![CDATA[
      $image2 = $this->model_tool_image->resize($results[0]['image']
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($results) > 1 && $image2 == $image) {
				$image2 = $this->model_tool_image->resize($results[1]['image'] ? $results[1]['image'] : (Front::$IS_OC2 ? 'placeholder.png' : 'no_image.jpg'), $this->config->get('config_image_product_width'), $this->config->get('config_image_product_height'));
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>
  
	<!-- journal2 compatibility -->
	<file name="catalog/view/theme/*/template/journal2/module/carousel_product.tpl,catalog/view/theme/*/template/journal2/module/custom_sections_product.tpl" error="skip">  
    
    <operation >
      <search position="replace"><![CDATA[
      alt="<?php echo $product['name']; ?>"
      ]]></search>
      <add><![CDATA[<?php /* Product Option Image PRO module << */ if (!empty($poip_installed)) { ?>alt="<?php echo $product['name']; ?>" data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>"<?php } else { ?>alt="<?php echo $product['name']; ?>"<?php } /*  >> Product Option Image PRO module */ ?>]]></add>

    </operation>
    
		
    <operation error="skip">
			<search position="after"><![CDATA[<div class="name">' + $(element).find('.name').html() + '</div>]]></search> 
      <add><![CDATA[
			// Product Option Image PRO module <<
			if ($(element).find('[data-poip_id="poip_img"]').length) { html += '<div data-poip_id=\'poip_img\'>' + $(element).find('[data-poip_id="poip_img"]').html() + '<div>' };
			//if ($(element).find('[data-poip_id="poip_img"]').length) { html += $('<div>').append( $(element).find('[data-poip_id="poip_img"]').clone() ).html() };
			//>> Product Option Image PRO module
			]]></add>
    </operation>
    
		<!--
    <operation >

			<search position="before" ><![CDATA[<div class="product-details">]]></search>
      <add><![CDATA[
				<?php /*
				<?php // Product Option Image PRO module <<  ?>
				<?php  if ( !empty($poip_installed) && isset($product['option_images']) && $product['option_images']) {
				
					foreach ($product['option_images'] as $product_option_id => $option_images) {
						
						echo "<div data-poip_id='poip_img'>";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
										
							echo "			 
											<a style=\"padding-left:6px; padding-top:2px; margin:0px; width:25px; height:25px; float:center; \" onmouseover=\"poip_show_thumb(this);\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img style=\"width:24px; height:24px;\" src=\"".$option_image['icon']."\"></a>
										 ";			
						}
						echo "</div>";
						
					}
				
				} ?>
				<?php //  >> Product Option Image PRO module ?>
				*/ ?>
      ]]></add>
    </operation>
		-->
		
  </file>
	
	
	<!-- mattimeo theme -->
	<file name="catalog/view/theme/mattimeo/template/product/category.tpl,catalog/view/theme/mattimeo/template/module/featured.tpl,catalog/view/theme/mattimeo/template/module/bestseller.tpl,catalog/view/theme/mattimeo/template/module/latest.tpl" error="skip">  
		<operation error="skip">
			<search position="after" offset="1"><![CDATA[
      <!--end additional images-->
      ]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && isset($product['option_images']) && $product['option_images']) {
      
				foreach ($product['option_images'] as $product_option_id => $option_images) {
          
					echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; \">";
					$image_counter = 0;
					foreach ($option_images as $product_option_value_id => $option_image) {
						$image_counter++;
						echo "
										<a ". ($poip_theme_name!="mattimeo" ? "onmouseover=\"poip_show_thumb(this);\"" : "") ."
											style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
											".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
											data-thumb=\"".$option_image['thumb']."\"
											data-image_id=\"".$current_class."_".$product['product_id']."\">
										<img src=\"".$option_image['icon']."\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
									";
					}
					echo "</div>";
					
        }
      
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
	</file>
	
	<!-- cosyone theme -->
	<file name="catalog/view/theme/*/template/product/category.tpl,catalog/view/theme/*/template/product/search.tpl">  
		<operation error="skip">
			<search position="after" ><![CDATA[
      <a href="<?php echo $product['href']; ?>"><img src="<?php echo $product['thumb']; ?>" alt="<?php echo $product['name']; ?>" /></a>
      ]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images'] && $poip_theme_name == 'cosyone') {
      
        foreach ($product['option_images'] as $product_option_id => $option_images) {
          
					echo "<div data-poip_id='poip_img'>";
					$image_counter = 0;
          foreach ($option_images as $product_option_value_id => $option_image) {
						$image_counter++;
									
						echo "			 
									<a style=\"padding-left:6px; padding-top:2px; margin:0px; width:25px; height:25px; float:left; \" onmouseover=\"poip_show_thumb(this);\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
										".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
										data-thumb=\"".$option_image['thumb']."\"
										data-image_id=\"".$current_class."_".$product['product_id']."\">
									<img style=\"width:24px; height:24px;\" src=\"".$option_image['icon']."\"></a>
								 ";		
          }
					echo "</div>";
					
        }
      
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
	</file>
  
	<!-- project-store -->
  <file name="catalog/view/theme/*/template/product/category.tpl" error="skip">  
		<operation error="skip">
			<search position="ibefore" ><![CDATA[
      include 'catalog/view/theme/project-store/template/product/pjs-include/pjs_grid_item.tpl';
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if (!empty($poip_installed)) {
				if (class_exists('VQMod')) {
					include( VQMod::modCheck('catalog/view/theme/project-store/template/product/pjs-include/pjs_grid_item.tpl') );
				} else {
					include( modification('catalog/view/theme/project-store/template/product/pjs-include/pjs_grid_item.tpl') );
				}
			} else 
			
      //  >> Product Option Image PRO module
      ]]></add>
    </operation>
	</file>
	
	<!-- project-store -->
  <file name="catalog/view/theme/*/template/module/*.tpl" error="skip">  
		<operation error="skip">
			<search position="ibefore" ><![CDATA[
      include 'catalog/view/theme/project-store/template/module/pjs-include/pjs_grid_item.tpl';
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if (!empty($poip_installed)) {
				if (class_exists('VQMod')) {
					include( VQMod::modCheck('catalog/view/theme/project-store/template/module/pjs-include/pjs_grid_item.tpl') );
				} else {
					include( modification('catalog/view/theme/project-store/template/module/pjs-include/pjs_grid_item.tpl') );
				}
			} else 
			
      //  >> Product Option Image PRO module
      ]]></add>
    </operation>
	</file>
	
	<!-- project-store -->
	<file name="catalog/view/theme/*/template/product/pjs-include/pjs_grid_item.tpl,catalog/view/theme/*/template/module/pjs-include/pjs_grid_item.tpl" error="skip">  

		<operation error="skip">
      <search position="iafter" ><![CDATA[
			src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>
    </operation>
		
	</file>
	
	<!-- eagency & goshop compatibility -->
	<file name="catalog/view/theme/*/template/new_elements/product.tpl" error="skip">
		<operation>
			<search position="after" offset="2" error="skip"><![CDATA[
			<a href="<?php echo $product['href']; ?>"><img
			]]></search>
      <add><![CDATA[
			<?php // Product Option Image PRO module << ?>
			
			
			
      <?php if (!empty($poip_installed) && isset($product['option_images']) && $product['option_images'] && $poip_theme_name != "mattimeo") {
			
				foreach ($product['option_images'] as $product_option_id => $option_images) {
					
					if ($poip_theme_name == 'fastor') {
					
						echo "<div data-poip_id=\"poip_img\" style=\"position: relative;\">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a onmouseover=\"poip_show_thumb(this);\" 
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
										";
						}
						echo "</div>";
					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
			]]></add>

    </operation>
		
		<operation error="skip">
			
      <search position="iafter" ><![CDATA[
			src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php /* Product Option Image PRO module << */ if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   /*  >> Product Option Image PRO module */ ?> ]]></add>

    </operation>
		
    <!-- goshop -->
    <operation error="skip">
      <search position="iafter" ><![CDATA[
			<img src="image/catalog/blank.gif" data-echo="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php /* Product Option Image PRO module << */ if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   /*  >> Product Option Image PRO module */ ?> ]]></add>

    </operation>
    
    <!-- goshop -->
    
    
              
    <operation error="skip">
			
      <search position="ibefore"><![CDATA[
			<a href="<?php echo $product['href']; ?>"><?php echo $product['name']; ?></a>
			]]></search>
      
      <!--
      <search position="after" offset="4"><![CDATA[
			<img src="image/catalog/blank.gif" data-echo="<?php echo $product['thumb']; ?>"
			]]></search>
      -->
      <add><![CDATA[
      
        <?php // << Product Option Image PRO module ?>
			
        <?php if (!empty($poip_installed) && isset($product['option_images']) && $product['option_images'] && $poip_theme_name == "goshop") {
          
          foreach ($product['option_images'] as $product_option_id => $option_images) {
          
            echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; margin-top: 3px; \">";
            $image_counter = 0;
            foreach ($option_images as $product_option_value_id => $option_image) {
              $image_counter++;
              echo "
                      <a onmouseover=\"poip_show_thumb(this);\" 
                        style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
                        ".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
                        data-thumb=\"".$option_image['thumb']."\"
                        data-image_id=\"".$current_class."_".$product['product_id']."\">
                      <img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
                    ";
            }
            echo "</div>";
          }
          
        } ?>
      
        <?php // >> Product Option Image PRO module  ?>
        
      ]]></add>

    </operation>          
    
	</file>
	
	<!-- lexus_shopping -->	
	<file name="catalog/view/theme/*/template/common/products_module.tpl,catalog/view/theme/*/template/product/products_related.tpl,catalog/view/theme/*/template/module/pavproductcarousel.tpl,catalog/view/theme/*/template/module/pavcategorytabs.tpl" error="skip">
		
		<operation error="skip">
			
      <search position="ireplace" ><![CDATA[require( $productLayout );]]></search>
      <add><![CDATA[
			
				/* Product Option Image PRO module << */
				
				if (!empty($poip_installed)) {
					require( VQMod::modCheck($productLayout) );
				} else {
					require( $productLayout );
				}
				
				
				/*  >> Product Option Image PRO module */
			
			]]></add>

    </operation>
		
	</file>
	
	<!-- rgen-opencart theme compatibility -->	
	<file path="rgen/catalog/template/product/" name="prd_block1.tpl,prd_block2.tpl,prd_block3.tpl,prd_block4.tpl" error="skip">
		<operation error="skip">
      <search position="iafter" ><![CDATA[
			src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>
    </operation>
	</file>
	
	<!-- category.tpl etc -->
	<file path="catalog/view/theme/*/template/" name="module/product_module.tpl,module/marketshop_product_tab.tpl,module/filter_product.tpl,pavdeals/list.tpl,product/product_collection.tpl,common/product_collection.tpl,common/product/default.tpl,common/product/swap.tpl,module/pavproducttabs.tpl,module/filterpro_products.tpl,journal2/module/super_filter_product.tpl,product/category.tpl,product/search.tpl,product/manufacturer_info.tpl,product/special.tpl,module/latest.tpl,module/bestseller.tpl,module/special.tpl,module/featured.tpl,extension/module/latest.tpl,extension/module/bestseller.tpl,extension/module/special.tpl,extension/module/featured.tpl,welldone/listing.php">  
  <!--<file name="catalog/view/theme/*/template/module/product_module.tpl,catalog/view/theme/*/template/module/marketshop_product_tab.tpl,catalog/view/theme/*/template/module/filter_product.tpl,catalog/view/theme/*/template/pavdeals/list.tpl,catalog/view/theme/*/template/product/product_collection.tpl,catalog/view/theme/*/template/common/product_collection.tpl,catalog/view/theme/*/template/common/product/default.tpl,catalog/view/theme/*/template/common/product/swap.tpl,catalog\view\theme\*\template\module\pavproducttabs.tpl,catalog\view\theme\*\template\module\filterpro_products.tpl,catalog\view\theme\*\template\journal2\module\super_filter_product.tpl,catalog/view/theme/*/template/product/category.tpl,catalog/view/theme/*/template/product/search.tpl,catalog/view/theme/*/template/product/manufacturer_info.tpl,catalog/view/theme/*/template/product/special.tpl,catalog/view/theme/*/template/module/latest.tpl,catalog/view/theme/*/template/module/bestseller.tpl,catalog/view/theme/*/template/module/special.tpl,catalog/view/theme/*/template/module/featured.tpl">  -->
    
		<!--
    <operation error="skip">
			
      <search position="ibefore"><![CDATA[
      alt="<?php echo $product['name'];
      ]]></search>
      <add><![CDATA[<?php /* Product Option Image PRO module << */ if ($poip_installed) { ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php } /*  >> Product Option Image PRO module */ ?>]]></add>

    </operation>
		-->
		<!-- << Pavilion (BurnEngine) -->
		<operation error="skip">
      <search position="before"><![CDATA[
				item_hover('#{{widget_dom_id}}'
      ]]></search>
      <add><![CDATA[
				// << Product Option Image PRO module
				var poip_BurnEngine_products_hover_timer = setInterval(function(){
					if (typeof(poip_wait_server_call)=='undefined' || !poip_wait_server_call) {
				// >> Product Option Image PRO module
			]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
				item_hover('#{{widget_dom_id}}'
      ]]></search>
      <add><![CDATA[
				// << Product Option Image PRO module
						clearInterval(poip_BurnEngine_products_hover_timer);
					}
				}, 100);
				// >> Product Option Image PRO module
			]]></add>
    </operation>
		<!-- >> Pavilion (BurnEngine) -->
		
		<!-- welldone theme compatibility -->
    <operation error="skip">
      <search position="replace"><![CDATA[
      <?php include("catalog/view/theme/welldone/template/welldone/listing.php");?>
      ]]></search>
      <add><![CDATA[
			<?php
				/* Product Option Image PRO module << */
				if ( !empty($poip_installed) ) {
					if (class_exists('VQMod')) {
						include( VQMod::modCheck('catalog/view/theme/welldone/template/welldone/listing.php') );
					} else {
						include( modification('catalog/view/theme/welldone/template/welldone/listing.php') );
					}
				} else {
					include('catalog/view/theme/welldone/template/welldone/listing.php');
				}
				/*  >> Product Option Image PRO module */
			?>
			]]></add>
    </operation>
		
		<!-- optimus theme compatibility -->
    <operation error="skip">
      <search position="replace"><![CDATA[
      <?php include('catalog/view/theme/listing.php'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				/* Product Option Image PRO module << */
				if ( !empty($poip_installed) ) {
					if (class_exists('VQMod')) {
						include( VQMod::modCheck('catalog/view/theme/listing.php') );
					} else {
						include( modification('catalog/view/theme/listing.php') );
					}
				} else {
					include('catalog/view/theme/listing.php');
				}
				/*  >> Product Option Image PRO module */
			?>
			]]></add>
    </operation>
    
    <!-- fastor theme compatibility -->
    <operation error="skip">
      <search position="replace"><![CDATA[
      <?php include('catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/new_elements/product.tpl'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				/* Product Option Image PRO module << */
				if ( !empty($poip_installed) ) {
					if (class_exists('VQMod')) {
						include( VQMod::modCheck('catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/new_elements/product.tpl') );
					} else {
						include( modification('catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/new_elements/product.tpl') );
					}
				} else {
					include('catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/new_elements/product.tpl');
				}
				/*  >> Product Option Image PRO module */
			?>
			]]></add>
    </operation>
    
		<operation error="skip">
      <search position="replace"><![CDATA[
      <?php include('catalog/view/theme/'.$config->get('config_template').'/template/new_elements/product.tpl'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				/* Product Option Image PRO module << */
				if (!empty($poip_installed)) {
					include( VQMod::modCheck('catalog/view/theme/'.$config->get('config_template').'/template/new_elements/product.tpl') );
				} else {
					include( 'catalog/view/theme/'.$config->get('config_template').'/template/new_elements/product.tpl' );
				}
				/*  >> Product Option Image PRO module */
			?>
			]]></add>
    </operation>
		
		<operation error="skip">
			
      <search position="iafter" ><![CDATA[
			src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>

    </operation>
		
		<!-- cosyone hover -->
		<operation error="skip">
			
      <search position="iafter" ><![CDATA[
			<img src="<?php echo $product['thumb_hover']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>

    </operation>
    
    <!-- goshop -->
    <operation error="skip">
			
      <search position="iafter" ><![CDATA[
			<a href="<?php echo $product['href']; ?>"><img src="image/catalog/blank.gif"
			]]></search>
      <add><![CDATA[ <?php /* Product Option Image PRO module << */ if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   /*  >> Product Option Image PRO module */ ?> ]]></add>

    </operation>
		
		<!-- lexus_shopping -->
		<operation  error="skip">
      <search position="replace"><![CDATA[
      <?php require( ThemeControlHelper::getLayoutPath( 'common/product_collection.tpl' ) );  ?>
      ]]></search>
      <add><![CDATA[
			<?php
				/* Product Option Image PRO module << */
				if (!empty($poip_installed)) {
					require( VQMod::modCheck( ThemeControlHelper::getLayoutPath( 'common/product_collection.tpl' ) ) );
				} else {
					require( ThemeControlHelper::getLayoutPath( 'common/product_collection.tpl' ) );
				}
				/*  >> Product Option Image PRO module */
			?>
			]]></add>
    </operation>
		
		<!-- lexus_shopping -->
		<operation  error="skip">
      <search position="replace"><![CDATA[
      <?php require( ThemeControlHelper::getLayoutPath( 'common/product/'.$listingConfig['product_layout'].'.tpl' ) );  ?>
      ]]></search>
      <add><![CDATA[
			<?php
				/* Product Option Image PRO module << */
				if (!empty($poip_installed)) {
					require( VQMod::modCheck( ThemeControlHelper::getLayoutPath( 'common/product/'.$listingConfig['product_layout'].'.tpl' ) ) );
				} else {
					require( ThemeControlHelper::getLayoutPath( 'common/product/'.$listingConfig['product_layout'].'.tpl' ) );
				}
				/*  >> Product Option Image PRO module */
			?>
			]]></add>
    </operation>
		
		<!-- lexus_shopping for bestsellers -->
		<operation  error="skip">
      <search position="ireplace"><![CDATA[require( DIR_TEMPLATE.$config->get('config_template')."/template/common/products_module.tpl" );]]></search>
      <add><![CDATA[
			
				/* Product Option Image PRO module << */
				if (!empty($poip_installed)) {
					require( VQMod::modCheck( DIR_TEMPLATE.$config->get('config_template')."/template/common/products_module.tpl" ) );
				} else {
					require( DIR_TEMPLATE.$config->get('config_template')."/template/common/products_module.tpl" );
				}
				/*  >> Product Option Image PRO module */
			
			]]></add>
    </operation>
		
		<!-- rgen -->
    <operation error="skip">
      <search position="replace" ><![CDATA[
			<?php include $this->rgen('prd'.$rgen['search_prd']['prd_style']); ?>
			]]></search>
      <add><![CDATA[
			<?php
				/* Product Option Image PRO module << */
				if ( !empty($poip_installed) ) {
					if (class_exists('VQMod')) {
						include( VQMod::modCheck( $this->rgen('prd'.$rgen['search_prd']['prd_style']) ) );
					} else {
						include( modification( $this->rgen('prd'.$rgen['search_prd']['prd_style']) ) );
					}
				} else {
					include( $this->rgen('prd'.$rgen['search_prd']['prd_style']) );
				}
				/*  >> Product Option Image PRO module */
			?>
			]]></add>
    </operation>
		
		<!-- pav styleshop -->
		<operation  error="skip">
			
      <search position="replace"><![CDATA[
      require( DIR_TEMPLATE.$poip_theme_name."/template/product/product_collection.tpl" );
      ]]></search>
      <add><![CDATA[
			/* Product Option Image PRO module << */
			if (!empty($poip_installed)) {
				require( VQMod::modCheck(DIR_TEMPLATE.$poip_theme_name."/template/product/product_collection.tpl" ) );
			} else {
				require( DIR_TEMPLATE.$poip_theme_name."/template/product/product_collection.tpl" );
			}
			/*  >> Product Option Image PRO module */
			]]></add>

    </operation>
		
    <!-- pav styleshop -->
		<operation  error="skip">
			
      <search position="replace"><![CDATA[
      require( DIR_TEMPLATE.$poip_theme_name."/template/module/product_module.tpl" );
      ]]></search>
      <add><![CDATA[
			/* Product Option Image PRO module << */
			if (!empty($poip_installed)) {
				require( VQMod::modCheck(DIR_TEMPLATE.$poip_theme_name."/template/module/product_module.tpl" ) );
			} else {
				require( DIR_TEMPLATE.$poip_theme_name."/template/module/product_module.tpl" );
			}
			/*  >> Product Option Image PRO module */
			]]></add>

    </operation>
    
		
    <operation error="skip">
			<search position="before"><![CDATA[<div class="name">' + $(element).find('.name').html() + '</div>]]></search>
      <!--<search position="before"><![CDATA[var price = $(element).find('.price').html();]]></search> -->
      <add><![CDATA[
			// Product Option Image PRO module <<
			<?php if ($poip_theme_name!='polianna' ) { ?>
				if ($(element).find('[data-poip_id="poip_img"]').length) {  html += $('<div>').append( $(element).find('[data-poip_id="poip_img"]').clone() ).html(); $(element).find('[data-poip_id="poip_img"]').remove() };
			<?php } ?>
			//>> Product Option Image PRO module
			]]></add>
    </operation>
    
		<operation error="skip">
			
			<!-- to one line for some themes -->
			<search position="iafter"><![CDATA[foreach ($products as $product) {]]></search>
      <add><![CDATA[/* << Product Option Image PRO module */ $poip_product_images_shown = false; /* variable to check and not show poip_img twice for the same product */ /* >> Product Option Image PRO module */ ]]></add>
    </operation>
		
		<!-- bt_comohos -->
		<operation error="skip">
			<search position="before" regex="true"><![CDATA[~<div class="caption">|<div class="pro-detail">~]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images']
							&& ($poip_theme_name == "bt_comohos" || $poip_theme_name == "theme573" || $poip_theme_name == "theme628" || $poip_theme_name == 'theme630' || $poip_theme_name == "theme640") ) {
			
				if (!isset($poip_product_images_shown)) $poip_product_images_shown = false;
				
				if (!$poip_product_images_shown) {
				
					$poip_product_images_shown = true;
				
					foreach ($product['option_images'] as $product_option_id => $option_images) {
						
						echo "<div data-poip_id=\"poip_img\" style=\"  text-align: left; margin-top: 3px; width:100%; \">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a onmouseover=\"poip_show_thumb(this);return false;\"
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" width=\"23\" height=\"23\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
										";
						}
						echo "</div>";
					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- different themes, different operations -->
		<!-- usual: default, sellegance etc -->
    <operation error="skip">

			<!-- MORE? compatible -->
			<search position="after" regex="true"><![CDATA[~<a href="<\?php echo \$product\['href'\]; \?>"><img~]]></search>
			
			<!-- skip for cosyone theme -->
			<ignoreif><![CDATA[<?php if ($product['thumb_hover'] && $cosyone_rollover_effect == 'enabled') { ?>]]></ignoreif>
			

      <add><![CDATA[
      
      <?php // Product Option Image PRO module << ?>
			
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images'] && $poip_theme_name != "mattimeo"
        && $poip_theme_name != "bt_comohos" && $poip_theme_name != 'stowear' && $poip_theme_name != 'themegloballite' && $poip_theme_name != 'logancee' ) {
				
				if (!isset($poip_product_images_shown) ) $poip_product_images_shown = false;
				
				if (!$poip_product_images_shown) {
				
					if ( $poip_theme_name !== 'marketshop') {
						$poip_product_images_shown = true;
					}
				
					foreach ($product['option_images'] as $product_option_id => $option_images) {
						
						if ($poip_theme_name == "sellegance" || $poip_theme_name == "theme422"
							|| $poip_theme_name == "polianna" || $poip_theme_name == "moneymaker"
							 ) {
							
							echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; \">";
							$image_counter = 0;
							foreach ($option_images as $product_option_value_id => $option_image) {
								$image_counter++;
								echo "
												<a ". ($poip_theme_name!="mattimeo" ? "onmouseover=\"poip_show_thumb(this);\"" : "") ."
													style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
													".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
													data-thumb=\"".$option_image['thumb']."\"
													data-image_id=\"".$current_class."_".$product['product_id']."\">
												<img src=\"".$option_image['icon']."\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
											";
							}
							echo "</div>";
	
						} elseif ($poip_theme_name == "pav_styleshop" ) { // for product_module.tpl
							// just skip
							
						} elseif ($poip_theme_name == "bt_comohos" ) {
						
						} elseif ($poip_theme_name == "welldone" ) { 
							
            } elseif ($poip_theme_name == 'fastor') { 
						
							echo "<div data-poip_id=\"poip_img\" style=\"   \">";
							$image_counter = 0;
							foreach ($option_images as $product_option_value_id => $option_image) {
								$image_counter++;
								echo "
												<a onmouseover=\"poip_show_thumb(this);\" 
													style=\"display:inline;float:left;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
													".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
													data-thumb=\"".$option_image['thumb']."\"
													data-image_id=\"".$current_class."_".$product['product_id']."\">
												<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
											";
							}
							echo "</div>";  
							
						} elseif ($poip_theme_name == "mariposa-purple") {
					
							echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; margin-top: 3px; \">";
							$image_counter = 0;
							foreach ($option_images as $product_option_value_id => $option_image) {
								$image_counter++;
								echo "
												<a onmouseover=\"poip_show_thumb(this);\" 
													style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
													".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
													data-thumb=\"".$option_image['thumb']."\"
													data-image_id=\"".$current_class."_".$product['product_id']."\">
												<img style=\"width:auto;height:auto;\" src=\"".$option_image['icon']."\" class=\"img-thumbnail\"></a>
											";
							}
							echo "</div>";	
						
						} else { // OC 2.0 new style default
						
							echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; margin-top: 3px; \">";
							$image_counter = 0;
							foreach ($option_images as $product_option_value_id => $option_image) {
								$image_counter++;
								echo "
												<a onmouseover=\"poip_show_thumb(this);\" 
													style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
													".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
													data-thumb=\"".$option_image['thumb']."\"
													data-image_id=\"".$current_class."_".$product['product_id']."\">
												<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
											";
											
								
											
							}
							echo "</div>";
						
						}
						
						/* OC 1.X old-style default
						} else {
						
							echo "<table data-poip_id=\"poip_img\" style=\"width: auto; padding:0px; border-collapse:collapse; border-spacing:0px; border:0px;\"><tr><td style='padding:0px;'>";
							$image_counter = 0;
							foreach ($option_images as $product_option_value_id => $option_image) {
								$image_counter++;
								if ($image_counter % 5 == 0) echo "<br>";
								echo "<div class=\"image\" style=\"float:left; margin-left:0px; margin-right:0px; \">
												<a onmouseover=\"poip_show_thumb(this);\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
													".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
													data-thumb=\"".$option_image['thumb']."\"
													data-image_id=\"".$current_class."_".$product['product_id']."\">
												<img src=\"".$option_image['icon']."\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
											</div>";
											
								if ($image_counter % 4 == 0) echo "<br>";
							}
							echo "</td></tr></table>";
						}
						*/
					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- aspire -->
		<operation error="skip">
			<search position="before"><![CDATA[
      <?php if($config->get('magikaspire_sale_label')==1) {
      ]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images'] && substr($poip_theme_name,0,6) == "aspire") {
				if (!isset($poip_product_images_shown) ) $poip_product_images_shown = false;
				if (!$poip_product_images_shown) {
					$poip_product_images_shown = true;
					foreach ($product['option_images'] as $product_option_id => $option_images) {
						
						echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; margin-top: 3px; \">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a onmouseover=\"poip_show_thumb(this);\" 
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
										";
						}
						echo "</div>";
					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
    <!-- pav_mode -->
    <operation error="skip">

			<!-- MORE? compatible -->
			<search position="before"><![CDATA[
      <div class="product-meta">
      ]]></search>

      <add><![CDATA[
      
      <?php // Product Option Image PRO module << ?>
			
      <?php if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images'] && $poip_theme_name == "pav_mode") {
				
				if (!isset($poip_product_images_shown) ) $poip_product_images_shown = false;
				
				if (!$poip_product_images_shown) {
				
					$poip_product_images_shown = true;
				
					foreach ($product['option_images'] as $product_option_id => $option_images) {
						
            echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; \">";
            $image_counter = 0;
            foreach ($option_images as $product_option_value_id => $option_image) {
              $image_counter++;
              echo "
                      <a onmouseover=\"poip_show_thumb(this);\"
                        style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
                        ".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
                        data-thumb=\"".$option_image['thumb']."\"
                        data-image_id=\"".$current_class."_".$product['product_id']."\">
                      <img src=\"".$option_image['icon']."\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
                    ";
            }
            echo "</div>";

					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- pav fashion -->
		<operation error="skip">
			<search position="before"><![CDATA[$.totalStorage('display', 'list');]]></search>
      <add><![CDATA[
			// << Product Option Image PRO module
			$('div#[data-poip_id="poip_img"]').css('top', 'auto');
			$('div.product-action').css('top', 'auto');
			//>> Product Option Image PRO module
			]]></add>
    </operation>
		
		<!-- pav fashion -->
		<operation error="skip">
			<search position="before"><![CDATA[$.totalStorage('display', 'grid');]]></search>
      <add><![CDATA[
			// << Product Option Image PRO module
			$('[data-poip_id="poip_img"]').css('top', '-6px');
			$('div.product-action').css('top', '-70px');
			$('a.pav-colorbox').css('top', 'auto');
			$('a.pav-colorbox').css('bottom', '-40px');
			//>> Product Option Image PRO module
			]]></add>
    </operation>
		
		<!-- pav fashion -->
		<!-- and for lexus_shopping common\product\default.tpl -->
		<operation error="skip">
			<search position="after" ><![CDATA[
      <div class="warp-info">
      ]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images']) {
        foreach ($product['option_images'] as $product_option_id => $option_images) {
					echo "<div data-poip_id='poip_img' style='width:100%; display: table-cell;  position:relative; top:-6px; z-index: 1000;'>";
					$image_counter = 0;
          foreach ($option_images as $product_option_value_id => $option_image) {
						$image_counter++;
						echo "			 
									<a style=\"margin:0px; margin-left:2px; margin-bottom:2px;  float:left; \" onmouseover=\"poip_show_thumb(this);\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
										".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
										data-thumb=\"".$option_image['thumb']."\"
										data-image_id=\"".$current_class."_".$product['product_id']."\">
									<img style=\"\" src=\"".$option_image['icon']."\"></a>
								 ";		
          }
					echo "</div>";
        }
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- pav styleshop for product_collection.tpl & product_module.tpl -->
		<operation error="skip">
			<!--
			<search position="before" ><![CDATA[
      <h3 class="name"><a href="<?php echo $product['href']; ?>
      ]]></search>
			-->
			<search position="before" ><![CDATA[
      <h3 class="name"><a href="<?php echo $product['href']; ?>"><?php echo $product['name']; ?></a></h3>
      ]]></search>
			<ignoreif><![CDATA[<div class="productdeals">]]></ignoreif>
			
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images']) {
        foreach ($product['option_images'] as $product_option_id => $option_images) {
					echo "<div data-poip_id='poip_img' style='width:100%; display: table-cell;  position:relative; top:-6px; z-index: 1000;'>";
					$image_counter = 0;
          foreach ($option_images as $product_option_value_id => $option_image) {
						$image_counter++;
						echo "			 
									<a style=\"margin:0px; margin-left:2px; margin-bottom:2px;  float:left; \" onmouseover=\"poip_show_thumb(this);\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
										".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
										data-thumb=\"".$option_image['thumb']."\"
										data-image_id=\"".$current_class."_".$product['product_id']."\">
									<img style=\"\" src=\"".$option_image['icon']."\"></a>
								 ";		
          }
					echo "</div>";
        }
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- different themes, different operations -->
		<!-- journal2 
    <operation error="skip">
		<search position="after" offset="4" error="skip"><![CDATA[<?php if($this->journal2->settings->get('product_grid_wishlist_icon_position')]]></search>

      <add><![CDATA[
      <?php /*
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images']) {
      
        foreach ($product['option_images'] as $product_option_id => $option_images) {
          
					echo "<div data-poip_id='poip_img' style='z-index: 5; margin-top: 5px; '>";
					$image_counter = 0;
          foreach ($option_images as $product_option_value_id => $option_image) {
						$image_counter++;
									
							echo "			 
                    <a style=\"padding-left:6px; padding-top:2px; margin:0px; width:25px; height:25px; float:center; \" onmouseover=\"poip_show_thumb(this);\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
                      ".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
                      data-thumb=\"".$option_image['thumb']."\"
                      data-image_id=\"".$current_class."_".$product['product_id']."\">
                    <img style=\"width:24px; height:24px;\" src=\"".$option_image['icon']."\"></a>
                   ";		
									
          }

					echo "</div>";
					
        }
      
      } ?>
      <?php //  >> Product Option Image PRO module ?>
			*/ ?>
      ]]></add>
    </operation>
		-->
		
		<!-- theme stowear compatibility - list -->
		<operation error="skip">
			<search position="before" offset="1"><![CDATA[
			<div class="name"><a href="<?php echo $product['href']; ?>"><?php echo $product['name']; ?></a></div>
			]]></search>
      <add><![CDATA[
			<?php // Product Option Image PRO module << ?>
			
      <?php if ( !empty($poip_installed) && isset($product['option_images']) && $product['option_images'] && $poip_theme_name != "mattimeo") {
			
				foreach ($product['option_images'] as $product_option_id => $option_images) {
					
					if ( $poip_theme_name == 'stowear' || $poip_theme_name == 'themegloballite' || $poip_theme_name == 'logancee' ) {
					
						echo "<div data-poip_id=\"poip_img\" style=\" display:inline-block;  \">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a onmouseover=\"poip_show_thumb(this);\" 
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\"></a>
										";
						}
						echo "</div>";
					
					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
			]]></add>

    </operation>
		
		<!-- theme stowear compatibility - grid in separate tpl-->
		<operation error="skip">
			
      <search position="replace"><![CDATA[
      <?php include('catalog/view/theme/'.$config->get('config_template').'/template/new_elements/product.tpl'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				/* Product Option Image PRO module << */
				
				if (!empty($poip_installed)) {
					include( VQMod::modCheck('catalog/view/theme/'.$config->get('config_template').'/template/new_elements/product.tpl') );
				} else {
					include( 'catalog/view/theme/'.$config->get('config_template').'/template/new_elements/product.tpl' );
				}
				
				
				/*  >> Product Option Image PRO module */
			?>
			]]></add>

    </operation>
    
    <!-- theme themegloballite compatibility - grid in separate tpl-->
		<operation error="skip">
      <search position="replace"><![CDATA[
      <?php include('catalog/view/theme/'.$config->get('config_template').'/template/themeglobal/product_grid.tpl'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				/* Product Option Image PRO module << */
				if (!empty($poip_installed)) {
          include( VQMod::modCheck( 'catalog/view/theme/'.$config->get('config_template').'/template/themeglobal/product_grid.tpl' ) );
				} else {
					include('catalog/view/theme/'.$config->get('config_template').'/template/themeglobal/product_grid.tpl');
				}
				/*  >> Product Option Image PRO module */
			?>
			]]></add>
    </operation>
    
    <!-- theme themegloballite compatibility - list in separate tpl-->
		<operation error="skip">
      <search position="replace"><![CDATA[
      <?php include('catalog/view/theme/'.$config->get('config_template').'/template/themeglobal/product_list.tpl'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				/* Product Option Image PRO module << */
				if (!empty($poip_installed)) {
          include( VQMod::modCheck( 'catalog/view/theme/'.$config->get('config_template').'/template/themeglobal/product_list.tpl' ) );
				} else {
					include('catalog/view/theme/'.$config->get('config_template').'/template/themeglobal/product_list.tpl');
				}
				/*  >> Product Option Image PRO module */
			?>
			]]></add>
    </operation>
    
    <!-- opc1000 - Fashion Store 2.0 theme -->
    <operation error="skip">
			<search position="before" ><![CDATA[
      <div class="caption">
      ]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images'] && $poip_theme_name == 'opc1000') {
      
        foreach ($product['option_images'] as $product_option_id => $option_images) {
          
					echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; margin-top: 3px; \">";
          $image_counter = 0;
          foreach ($option_images as $product_option_value_id => $option_image) {
            $image_counter++;
            echo "
                    <a onmouseover=\"poip_show_thumb(this);\" 
                      style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
                      ".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
                      data-thumb=\"".$option_image['thumb']."\"
                      data-image_id=\"".$current_class."_".$product['product_id']."\">
                    <img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
                  ";
          }
          echo "</div>";
					
        }
      
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
    
    
    <operation error="skip">
			<search position="before" ><![CDATA[
      <div class="row product-bottom-info">
      ]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images'] && $poip_theme_name == 'moment') {
      
        foreach ($product['option_images'] as $product_option_id => $option_images) {
          
					echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; margin-top: 3px; \">";
          $image_counter = 0;
          foreach ($option_images as $product_option_value_id => $option_image) {
            $image_counter++;
            echo "
                    <a onmouseover=\"poip_show_thumb(this);$('.product-thumb__secondary').hide();\" onmouseout=\"$('.product-thumb__secondary').show();\"
                      style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
                      ".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
                      data-thumb=\"".$option_image['thumb']."\"
                      data-image_id=\"".$current_class."_".$product['product_id']."\">
                    <img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
                  ";
          }
          echo "</div>";
					
        }
      
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
  </file>
	
	<!-- optimus theme specific file -->
	<file name="catalog/view/theme/listing.php" error="skip">
		<operation error="skip">
			
      <search position="iafter" ><![CDATA[
			src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>

    </operation>
	</file>
	
	<!-- stowear && themeglobal compatibility - grid-->
	<file name="catalog/view/theme/*/template/new_elements/product.tpl,catalog/view/theme/*/template/themeglobal/product_grid.tpl" error="skip">
		
		<operation>
			<search position="after" error="skip"><![CDATA[
			<div class="right">
			]]></search>
      <add><![CDATA[
			<?php // Product Option Image PRO module << ?>
			
      <?php if ( !empty($poip_installed) && isset($product['option_images']) && $product['option_images'] && $poip_theme_name != "mattimeo") {
			
				foreach ($product['option_images'] as $product_option_id => $option_images) {
					
					if ( $poip_theme_name == 'stowear' || $poip_theme_name == 'themegloballite' || $poip_theme_name == 'logancee' ) {
					
						echo "<div data-poip_id=\"poip_img\" style=\" display:inline-block;  \">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a onmouseover=\"poip_show_thumb(this);\" 
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\"></a>
										";
						}
						echo "</div>";
					
					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
			]]></add>

    </operation>
		
		<operation error="skip">
      <search position="iafter" ><![CDATA[
			src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php /* Product Option Image PRO module << */ if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   /*  >> Product Option Image PRO module */ ?> ]]></add>
    </operation>
		
	</file>
  
  <!-- themeglobal compatibility - list -->
	<file name="catalog/view/theme/*/template/themeglobal/product_list.tpl" error="skip">
		
		<operation>
			<search position="after"><![CDATA[
			<div class="name-desc col-sm-6">
			]]></search>
      <add><![CDATA[
			<?php // Product Option Image PRO module << ?>
			
      <?php if ( !empty($poip_installed) && isset($product['option_images']) && $product['option_images'] && $poip_theme_name != "mattimeo") {
			
				foreach ($product['option_images'] as $product_option_id => $option_images) {
					
					if ( $poip_theme_name == 'themegloballite' ) {
					
						echo "<div data-poip_id=\"poip_img\" style=\" display:inline-block;  \">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a onmouseover=\"poip_show_thumb(this);\" 
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\"></a>
										";
						}
						echo "</div>";
					
					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
			]]></add>

    </operation>
		
		<operation error="skip">
      <search position="iafter" ><![CDATA[
			src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php /* Product Option Image PRO module << */ if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   /*  >> Product Option Image PRO module */ ?> ]]></add>
    </operation>
		
	</file>	
    
  <file name="catalog/controller/common/header.php">  
    
    <operation >
      <search position="after"><![CDATA[
      function index() {
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
			
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
			$data['poip_settings'] = $this->model_module_product_option_image_pro->getSettings();
			$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			$data['poip_inclide_file_name_default'] = $this->model_module_product_option_image_pro->getTemplateIncludeFileName('list', true);
			$data['poip_inclide_file_name_custom'] = $this->model_module_product_option_image_pro->getTemplateIncludeFileName('list');
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>  
    
  <!-- journal2 theme header compatibility -->
  <file name="catalog/view/theme/journal2/template/common/header.tpl" error="skip">
    
    <operation error="skip">
      <search position="before" index="2"><![CDATA[
      <?php if (version_compare(VERSION, '2.1', '<')): ?>
      ]]></search>
      <add><![CDATA[
      <?php /* POIP poip_show_thumb place */ ?>
      ]]></add>
    </operation>
    
  </file>
	
	<!-- journal2 hide carousel from the start -->
	<file name="catalog/view/theme/journal2/template/product/product.tpl" error="skip">
    
    <operation error="skip">
      <search position="iafter" ><![CDATA[
      <div id="product-gallery"
      ]]></search>
      <add><![CDATA[
				style="height:0px;"
      ]]></add>
    </operation>
    
  </file>
    
    
  <file name="catalog/view/theme/*/template/common/header.tpl">    
    
    <!-- SCRIPT -->
		<!-- before </head> -->
    <operation >
			<search position="before" regex="true" index="1"><![CDATA[~POIP poip_show_thumb place|</head>~]]></search>
			<!-- both analitics may be wrong for BurnEngine -->
			<!--<search position="before" regex="true" index="1"><![CDATA[~POIP poip_show_thumb place|</head>|echo \$google_analytics;|foreach \(\$analytics as \$analytic\) { \?>~]]></search>-->
      <!--<ignoreif><![CDATA[function poip_show_thumb(elem) {]]></ignoreif>-->
			<!-- <search position="before" regex="true"><![CDATA[~echo \$google_analytics;|foreach \(\$analytics as \$analytic\) { \?>~]]></search> -->
			<!--<search position="before" regex="true" index="1"><![CDATA[~echo \$google_analytics;|foreach \(\$analytics as \$analytic\) { \?>~]]></search>-->
			<!--
      <search position="after"><![CDATA[
			$google_analytics;  
      ]]></search>
			-->
      <add><![CDATA[
			
			<?php // << Product Option Image PRO ?>
			
			<?php if ( !empty($poip_installed) ) { ?>
				<script  type = "text/javascript" ><!--
					function poip_show_thumb(elem) {
						
						if ($(elem).attr('data-thumb') && $(elem).attr('data-image_id')) {
										
							var main_img = $('img[data-poip_id="image_'+$(elem).attr('data-image_id')+'"]');
							if (main_img.length == 0) {
								main_img = $('img[data-poip_id="'+$(elem).attr('data-image_id')+'"]');
							}
							
							var prev_img = main_img.attr('src'); // journal2 compatibility
							main_img.attr('src', $(elem).attr('data-thumb'));
							main_img.closest('a').attr('href', $(elem).attr('href'));
							
							// moment theme compatibility (second image)
							if ( main_img.parent().parent().is('div.product-thumb__primary') ) {
								main_img.parent().parent().siblings('div.product-thumb__secondary').find('a').attr('href', $(elem).attr('href'));
							}
							
							// journal2 compatibility
							if (main_img.parent().hasClass('has-second-image')) {
								main_img.parent().attr('style', main_img.parent().attr('style').replace(prev_img, $(elem).attr('data-thumb')) );
							}
							
						}
					}
				//--></script>
			<?php } ?>
					
			<?php
			
				if ( !empty($poip_installed) ) {
					if ( !empty($poip_inclide_file_name_custom) ) {
					
						// for poip_list (for common/header script) default should be loaded only if custom exists
						if ( !empty($poip_inclide_file_name_default) ) {
							if (class_exists('VQMod')) {
								include( VQMod::modCheck( modification($poip_inclide_file_name_default) ) );
							} else {
								include( modification($poip_inclide_file_name_default) );
							}
						}
					
						if (class_exists('VQMod')) {
							include( VQMod::modCheck( modification($poip_inclide_file_name_custom) ) );
						} else {
							include( modification($poip_inclide_file_name_custom) );
						}
						
					}
					
					if (isset($poip_theme_name) && $poip_theme_name=='cosyone') {
						set_include_path(get_include_path() . PATH_SEPARATOR . DIR_APPLICATION.'/view/theme/cosyone/template/common');
					}
				}
			?>
			<?php // >> Product Option Image PRO ?>
			]]></add>
    </operation>
		
  </file>
  
  <!-- картинки в корзинке -->
  <file name="system/library/cart.php,system/library/cart/cart.php" error="skip">    
  
    
   <operation >
      <search position="after"><![CDATA[
      class Cart {
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			private $poipregistry;
      //private $poiploader;
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation >
      <search position="after"><![CDATA[
      public function __construct($registry) {
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			$this->poipregistry = $registry;
      //$this->poiploader = $registry->get('load');
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
    <operation >
			<search position="before" regex="true"><![CDATA[~\$this->data\[\$key\] = array\(|\$product_data\[\] = array\(~]]></search>
			<!--
      <search position="before"><![CDATA[
      $this->data[$key] = array(
      ]]></search>
			-->
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      /*
			global $registry;
      //global $loader, $registry;
			
			if ($registry) {
				$poipregistry = $registry;
			} else {
				$poipregistry = $this->poipregistry;
			}
			$poiploader = new Loader($poipregistry);
      */
      $poiploader = $this->poipregistry->get('load');
			
      $poiploader->model('module/product_option_image_pro');
      $poip_model = $this->poipregistry->get('model_module_product_option_image_pro');
      //$poip_model = $poipregistry->get('model_module_product_option_image_pro');
      $product_query->row['image'] = $poip_model->getProductCartImage($product_query->row['product_id'], $option_data, $product_query->row['image']);
      
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>
  


	<!-- <<<< Product Option Image PRO - compatibility with Product images anywhere  / Изображения опций PRO - совместимость с Product images anywhere</id> -->
  
  
  <!-- Product Images in Checkout -->
  <file name="catalog/controller/checkout/confirm.php">
		<operation error="skip">
			<search position="before"><![CDATA[
			$thumb = $this->model_tool_image->resize($image, 60, 60);
			]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $image = $this->model_module_product_option_image_pro->getProductCartImage((int)$product['product_id'], $product['option'], $image);
      // >> Product Option Image PRO module
			]]></add>
		</operation>
  </file>
	
	<!-- journal2 compatibility Product Images in temp-success-window -->
	<file name="catalog/controller/checkout/cart.php">
		<operation error="skip">
			<search position="before"><![CDATA[
			$json['image'] = Journal2Utils::resizeImage($this->model_tool_image, $product_info['image']
			]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
			$poip_options = array();
			foreach ($option as $po_id => $pov_id) {
				$poip_options[] = array('product_option_id'=>$po_id, 'product_option_value_id'=>$pov_id);
			}
      $product_info['image'] = $this->model_module_product_option_image_pro->getProductCartImage((int)$product_info['product_id'], $poip_options, $product_info['image']);
      // >> Product Option Image PRO module
			]]></add>
		</operation>
  </file>
  
  
  <file name="catalog/model/checkout/order.php">
		
		<!-- Product Images in Order Order Email -->
		<operation error="skip">
			<search position="before"><![CDATA[
			$thumb = $this->model_tool_image->resize($image, 60, 60);
			]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      $order_option_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "order_option WHERE order_id = '" . (int)$order_id . "' AND order_product_id = '" . (int)$product['order_product_id'] . "'");
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $image = $this->model_module_product_option_image_pro->getProductCartImage((int)$product['product_id'], $order_option_query->rows, $image);
      // >> Product Option Image PRO module
			]]></add>
		</operation>
		
		<!-- compatibility with other modification to show images in order -->
		<operation error="skip">
			<search position="before"><![CDATA[
			if ($product_info['image']) {
			]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
			if ( $this->model_module_product_option_image_pro->installed() ) {
				
				if ( !$this->model_account_order ) {
					$this->load->model('account/order');
				}
			
				$poip_options = $this->model_account_order->getOrderOptions($order_id, $product['order_product_id']);
				if ( !empty($poip_options) ) {
					$product_info['image'] = $this->model_module_product_option_image_pro->getProductCartImage((int)$product_info['product_id'], $poip_options, $product_info['image']);
				}
				unset($poip_options);
			}
      // >> Product Option Image PRO module
			]]></add>
		</operation>
		
  </file>
	
  <file name="catalog/controller/account/order.php">
		
		<!-- Product Images in Order History Page -->
		<operation error="skip">
			<search position="before"><![CDATA[
			$thumb = $this->model_tool_image->resize($image, 60, 60);
			]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $image = $this->model_module_product_option_image_pro->getProductCartImage((int)$product['product_id'], $options, $image);
      // >> Product Option Image PRO module
			]]></add>
		</operation>
		
		<!-- compatibility with other modification to show images in order -->
		<operation error="skip">
			<search position="before"><![CDATA[
			if ($product_info['image']) {
			]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
			if ( $this->model_module_product_option_image_pro->installed() && !empty($options) ) {
				$product_info['image'] = $this->model_module_product_option_image_pro->getProductCartImage((int)$product_info['product_id'], $options, $product_info['image']);
			}
      // >> Product Option Image PRO module
			]]></add>
		</operation>
		
  </file>

	<!-- >>>> Product Option Image PRO - compatibility with Product images anywhere  / Изображения опций PRO - совместимость с Product images anywhere</id> -->

	
	<!-- Images for RadioBoxes and Checkboxes -->
	<file name="catalog/view/theme/*/template/product/product.tpl,catalog/view/theme/*/template/product/product_detail_hitech.tpl" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
			<input type="radio" name="option
			]]></search>
			<add><![CDATA[
			<?php
			// << Product Option Image PRO module

			if ($option['type'] == 'radio' && isset($option_value['poip_image']) && $option_value['poip_image'] ) {
				?>
				<img src="<?php echo $option_value['poip_image']; ?>" alt="<?php echo $option_value['name'] . ($option_value['price'] ? ' ' . $option_value['price_prefix'] . $option_value['price'] : ''); ?>" class="img-thumbnail" /> 
				<?php
			}
			
      // >> Product Option Image PRO module
			?>
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="after"><![CDATA[
			<input type="checkbox" name="option
			]]></search>
			<add><![CDATA[
			<?php
			// << Product Option Image PRO module

			if ($option['type'] == 'checkbox' && isset($option_value['poip_image']) && $option_value['poip_image'] ) {
				?>
				<img src="<?php echo $option_value['poip_image']; ?>" alt="<?php echo $option_value['name'] . ($option_value['price'] ? ' ' . $option_value['price_prefix'] . $option_value['price'] : ''); ?>" class="img-thumbnail" /> 
				<?php
			}
			
      // >> Product Option Image PRO module
			?>
			]]></add>
		</operation>
		
  </file>
	
	
  <file name="catalog/controller/product/product.php">
		<operation error="skip">
			<search position="after"><![CDATA[
			$product_option_value_data[] = array(
			]]></search>
			<add><![CDATA[
			
			// << Product Option Image PRO module
      
			'poip_image'                   => (isset($option_value['poip_image']) && $option_value['poip_image'])
				? ( strpos($this->model_module_product_option_image_pro->getThemeName(), 'journal2') === 0 ? Journal2Utils::resizeImage($this->model_tool_image, $option_value['poip_image'], $this->journal2->settings->get('product_page_options_push_image_width', 30), $this->journal2->settings->get('product_page_options_push_image_height', 30), 'crop') : $this->model_tool_image->resize($option_value['poip_image'], 50, 50) )
				: '',
			
      // >> Product Option Image PRO module
			
			]]></add>
		</operation>
  </file>
	
	
	
	
	<!-- Product Option Discount compatibility -->
	<file name="catalog/controller/myoc/pod.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
			$product_option_value_data[] = array(
			]]></search>
			<add><![CDATA[
			
			// << Product Option Image PRO module
			'poip_image'						=> isset($product_option_value['poip_image']) ? $this->model_tool_image->resize($product_option_value['poip_image'], 50, 50) : false,
      // >> Product Option Image PRO module
			
			
			]]></add>
		</operation>
  </file>
	
	<!-- Product Option Discount compatibility -->
	<file name="catalog/view/theme/*/template/myoc/pod.tpl" error="skip">
		<operation error="skip">
			<search position="before"><![CDATA[
			<?php if($option['type'] == 'image') { ?>
			]]></search>
			<add><![CDATA[
			<?php
			// << Product Option Image PRO module
      if($option['type'] != 'image' && isset($option_value['poip_image']) && $option_value['poip_image'] ) { ?>
				<img src="<?php echo $option_value['poip_image']; ?>" alt="<?php echo $option_value['name'] . ($option_value['price'] ? ' ' . $option_value['price_prefix'] . $option_value['price'] : ''); ?>">
			<?php } 
      // >> Product Option Image PRO module
			?>
			]]></add>
		</operation>
  </file>
	
	<!-- bt_claudine boss zoom compatibility (and other bt_) -->
	<file name="catalog/controller/module/boss_zoom.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
			$results = $this->model_catalog_product->getProductImages($product_id);
			]]></search>
			<add><![CDATA[
			
			// << Product Option Image PRO module
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      if ( $this->model_module_product_option_image_pro->installed() ) {
        $poip_results = $this->model_module_product_option_image_pro->addOptionImagesToProductImages($results, $product_id, array(), $data['zoom_image_width'], $data['zoom_image_heigth'] );
        $results = $poip_results['results'];
        $product_images = $poip_results['product_images'];
				//$product_images = array();
        //$results = $this->model_module_product_option_image_pro->addOptionImagesToProductImages($results, $product_id, array(&$product_images), $data['zoom_image_width'], $data['zoom_image_heigth']);
				$data['poip_images'] = $product_images;
        $data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();;
			}
      // >> Product Option Image PRO module
			
			]]></add>
		</operation>
  </file>
	
	<!-- bt_claudine boss zoom compatibility (and some other bt_) -->
	<file name="catalog/view/theme/*/template/module/boss_zoom.tpl" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
			<script type="text/javascript" src="catalog/view/javascript/bossthemes/cloud-zoom/cloud-zoom.1.0.3.js"></script>
			]]></search>
			<add><![CDATA[
			<script type="text/javascript"><!--
			// << Product Option Image PRO module
      <?php
			
			if (isset($poip_images)) {
				echo 'var poip_images2 = '.json_encode($poip_images);
			}
			
			?>
      // >> Product Option Image PRO module
			//--></script>
			]]></add>
		</operation>
    
    
    <operation error="skip">
			<search position="after"><![CDATA[
			<?php foreach ($images as $image) { ?>
			]]></search>
			<add><![CDATA[
      <?php
        // << Product Option Image PRO module
        if ( !empty($poip_theme_name) && $poip_theme_name == 'bt_leather' ) {
          if ( empty($poip_shown_imgs) ) $poip_shown_imgs = array();
          if ( in_array($image['popup'], $poip_shown_imgs) ) continue;
          $poip_shown_imgs[] = $image['popup'];
        }
        // >> Product Option Image PRO module
			?>
			]]></add>
		</operation>
    
  </file>
	
	<!-- iWatermark compatibility -->
	<file name="catalog/model/tool/image.php" error="skip">
		<operation error="skip">
			<search position="replace"><![CDATA[
			$inProducts = $this->db->query('(SELECT image FROM ' . DB_PREFIX . 'product p JOIN ' . DB_PREFIX . 'product_to_category p2c ON (p.product_id = p2c.product_id) WHERE p.image="' . $filename . '"' . (!empty($extra_conditions) ? ' AND (' . implode(' OR ', $extra_conditions) . ')' : '') . ') UNION (SELECT image FROM ' . DB_PREFIX . 'product_image p JOIN ' . DB_PREFIX . 'product_to_category p2c ON (p.product_id = p2c.product_id) WHERE p.image="' . $filename . '"' . (!empty($extra_conditions) ? ' AND (' . implode(' OR ', $extra_conditions) . ')' : '') . ')');
			]]></search>
			<add><![CDATA[
			
			// << Product Option Image PRO module replacement
			
			$inProducts = $this->db->query('(	SELECT image
																				FROM ' . DB_PREFIX . 'product p
																					JOIN ' . DB_PREFIX . 'product_to_category p2c ON (p.product_id = p2c.product_id)
																				WHERE p.image="' . $filename . '"' . (!empty($extra_conditions) ? '
																					AND (' . implode(' OR ', $extra_conditions) . ')' : '') . ')
																				UNION (	SELECT image
																								FROM ' . DB_PREFIX . 'product_image p
																									JOIN ' . DB_PREFIX . 'product_to_category p2c ON (p.product_id = p2c.product_id)
																									WHERE p.image="' . $filename . '"' . (!empty($extra_conditions) ? '
																										AND (' . implode(' OR ', $extra_conditions) . ')' : '') . ')
																										
																				UNION (	SELECT image
																								FROM ' . DB_PREFIX . 'poip_option_image p
																									JOIN ' . DB_PREFIX . 'product_to_category p2c ON (p.product_id = p2c.product_id)
																								WHERE p.image="' . $filename . '"' . (!empty($extra_conditions) ? '
																									AND (' . implode(' OR ', $extra_conditions) . ')' : '') . ')						
																										
																				');
			
      // >> Product Option Image PRO module replacement
			
			]]></add>
		</operation>
  </file>
	
	<!-- theme500 - do not show main image twice if it's added to additional images (and do not show additional images twice ) -->
	<file name="catalog/view/theme/theme500/template/product/product.tpl" error="skip">
		
		<operation error="skip">
			<search position="iafter"><![CDATA[<?php if (!empty($thumb)) {]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
				$added_images = array($popup);
			// >> Product Option Image PRO
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="iafter"><![CDATA[<?php foreach ($images as $image) {]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
				if ( in_array($image['popup'], $added_images) ) continue;
				$added_images[] = $image['popup'];
			// >> Product Option Image PRO
			]]></add>
		</operation>
		
  </file>
	
	<!-- BurnEngine (Pavilion theme, may be Kiddos too) -->
	<file name="catalog/view/theme/BurnEngine/template/product/product.tpl" error="skip">
		
		<operation error="skip">
			<search position="before"><![CDATA[<div id="product_images"]]></search>
			<add><![CDATA[
			<script type="text/javascript"><!--
			// << Product Option Image PRO
			var poip_BurnEngineSlider = false;
			var poip_BurnEngineCallback = false;
			var poip_BurnEngineZoomPreview = false;
			// >> Product Option Image PRO
			--></script>
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="before"><![CDATA[var myInterval = null;]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
			poip_BurnEngineSlider = $slider;
			// >> Product Option Image PRO
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="replace"><![CDATA[if ($(this).attr('href') != $slider.slides[index].options.cover) {]]></search>
			<add><![CDATA[
			//  Product Option Image PRO replaced
			//if ( typeof($slider.slides[index]) == 'undefined' || $(this).attr('href') != $slider.slides[index].options.cover && typeof(zoom_preview) == 'function' ) {
			if (typeof($slider.slides[index]) == 'undefined' || $(this).attr('href') != $slider.slides[index].options.cover) {
				if ( typeof(zoom_preview) == 'undefined' ) {
					zoom_preview = function(){};
				}
			//if ($(this).attr('href') != $slider.slides[index].options.cover) {
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="before" offset="1"><![CDATA[$(document).one("ajaxStop.product-images", function() {]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
			poip_BurnEngineCallback = callback;
			// >> Product Option Image PRO
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="before" ><![CDATA[$('#{{widget_dom_id}} .tb_zoom_box.tb_zoom_click').bind('click', function(){]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
			if (typeof(zoom_preview)!='undefined') {
				poip_BurnEngineZoomPreview = zoom_preview;
			}
			// >> Product Option Image PRO
			]]></add>
		</operation>

		
		<operation error="skip">
			<search position="before"><![CDATA[<div data-mightyslider="type: 'image', cover: '<?php echo $tbData->escapeImg($image['popup']); ?>']]></search>
			<add><![CDATA[
			<?php
				// << Product Option Image PRO
				if (!empty($poip_installed) && !empty($popup) && $popup==$image['popup'] ) continue;
				// >> Product Option Image PRO
			?>
			]]></add>
		</operation>
		
  </file>
	
	<!-- seopro compatibility -->
	<file name="catalog/controller/common/seo_pro.php" error="skip">
		<operation error="skip">
			<search position="before"><![CDATA[if (isset($tmp['tracking'])) {]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      if (isset($tmp['poip_ov'])) {
				$data['poip_ov'] = $tmp['poip_ov'];
			}
      // >> Product Option Image PRO module
			]]></add>
		</operation>
  </file>
	
	<!-- << sellegance compatibility -->
	<file path="catalog/controller/product/" name="category.php,special.php,manufacturer.php,search.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
				if ($result['image']) {
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if (!empty($swapImg)) {
					$poip_product_image = $result['image'];
					if ( $poip_product_image == $swapImg && count($images) > 1 && !empty($images[1]['image']) ) {
						$swapImg = $images[1]['image'];
					}
				}
				// >> Product Option Image PRO module
			]]></add>
		</operation>
	</file>

	<file path="catalog/controller/module/" name="related.php,bestseller.php,latest.php,special.php,anylist.php,tabbed_products.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
				if ($result['image']) {
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if (!empty($swapImg)) {
					$poip_product_image = $result['image'];
					if ( $poip_product_image == $swapImg && count($images) > 1 && !empty($images[1]['image']) ) {
						$swapImg = $images[1]['image'];
					}
				}
				// >> Product Option Image PRO module
			]]></add>
		</operation>
		<!-- featured block -->
		<operation error="skip">
			<search position="after"><![CDATA[
				if ($product_info['image']) {
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if (!empty($swapImg)) {
					$poip_product_image = $product_info['image'];
					if ( $poip_product_image == $swapImg && count($images) > 1 && !empty($images[1]['image']) ) {
						$swapImg = $images[1]['image'];
					}
				}
				// >> Product Option Image PRO module
			]]></add>
		</operation>
	</file>

	<file name="catalog/controller/module/featured.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
				if ($product_info['image']) {
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if (!empty($swapImg)) {
					$poip_product_image = $product_info['image'];
					if ( $poip_product_image == $swapImg && count($images) > 1 && !empty($images[1]['image']) ) {
						$swapImg = $images[1]['image'];
					}
				}
				// >> Product Option Image PRO module
			]]></add>
		</operation>
	</file>
	<!-- >> sellegance compatibility -->

	<!-- << OC 2.3 fix -->
	<file name="admin/controller/user/user_permission.php" error="skip">
		<operation error="skip">
			<search position="before"><![CDATA[sort($files);]]></search>
			<add><![CDATA[
			// << Related Options
			if (VERSION >= '2.3.0.0') {
				$moduleFileNameOld = DIR_APPLICATION.'controller/module/product_option_image_pro.php';
				$moduleFileNameNew = DIR_APPLICATION.'controller/extension/module/product_option_image_pro.php';
				/*
				// for new controller location
				if ( in_array($moduleFileNameNew, $files) && in_array($moduleFileNameOld, $files) ) {
					$files = array_diff($files, array($moduleFileNameOld));
				}
				*/
				// for old controller location
				if (in_array($moduleFileNameOld, $files) && !in_array($moduleFileNameNew, $files)) {
					$files[] = $moduleFileNameNew;
				}
			}
			// >> Related Options
			]]></add>
		</operation>
	</file>
	
	<!-- compatibility old version fix -->
	<file name="admin/controller/event/compatibility.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[$route = $part[1] . '/' . $part[2];]]></search>
			<add><![CDATA[
			// << Related Options
			if (VERSION >= '2.3.0.0') {
				if (!empty($part[3])) {
					$route = $route . '/' . $part[3];
					unset($part[3]);
					$part = array_values($part);
				}
			}
			// >> Related Options
			]]></add>
		</operation>
	</file>
	<!-- >> OC 2.3 fix -->
	
</modification>